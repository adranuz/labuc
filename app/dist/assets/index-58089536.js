import{r as g,j as e,b as f,f as D,i as $}from"./index-0c29d899.js";import{d as q,D as F,a as z,b as A,c as _,e as N,f as O,g as W}from"./Delete-dad75097.js";import{d as J}from"./Search-c54aedb7.js";import{u as G}from"./common-3c77f740.js";import{a as L}from"./api-ff746449.js";import{B as j,P as H}from"./Page-1a493442.js";import{A as M}from"./Alert-4c46d2e6.js";import{B as I}from"./Box-c9cec713.js";import{T,b as E,P as V}from"./Typography-3ca4fb90.js";import{L as K}from"./LoadingButton-047ce5b6.js";import{E as v}from"./styled-1354fb8a.js";import{I as Q}from"./Select-1f0e709b.js";import{T as X}from"./Toolbar-5d78288d.js";import{L as Y,T as Z,a as ee,b as ae,c as R,d as c,e as re}from"./TableRow-fc5bf907.js";import{S as U}from"./Stack-75599046.js";import{C as se}from"./Chip-e70051c9.js";import{T as te}from"./TablePagination-a016ec4b.js";import{C as ne}from"./Container-18546780.js";import"./Backdrop-956e9521.js";import"./Menu-98bf16ef.js";import"./createSvgIcon-3d5d7fc7.js";import"./KeyboardArrowRight-b37c2a27.js";import"./MenuItem-0b7c80ac.js";import"./dividerClasses-a1a459bd.js";function ie({id:s,name:d,onFinished:m}){var x;const[b,p]=g.useState(!1),[n,u]=g.useState(!1),o=G(i=>i.showSnackbar),h=()=>{p(!0)},l=()=>{p(!1)},P=()=>{C({id:s})},C=({id:i})=>{u(!0);const a=new URL(`${L}/users/${i}`);fetch(a,{method:"DELETE"}).then(t=>t.json()).then(t=>{o("El usuario se eliminó corretamente","success"),m()}).catch(t=>o("Error al intentar eliminar el usuario","error")).finally(()=>{p(!1),u(!1)})},S=()=>{const i=localStorage.getItem("token");if(i)return w(i)},w=i=>JSON.parse(decodeURIComponent(escape(atob(i.split(".")[1]))));return e.jsxs(e.Fragment,{children:[e.jsx(j,{size:"small",color:"error",startIcon:e.jsx(q,{}),onClick:h,disabled:s===((x=S())==null?void 0:x.id),children:"Eliminar"}),e.jsxs(F,{fullWidth:!0,maxWidth:"sm",open:b,onClose:l,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(z,{id:"alert-dialog-title",children:"Eliminar usuario"}),e.jsxs(A,{children:[e.jsxs(_,{id:"alert-dialog-description",children:[e.jsx(M,{severity:"error",children:"Depués de eliminar un usuario, este se borra de manera permanente. Esta acción no se puede deshacer."}),e.jsxs(I,{m:2,children:[e.jsx(T,{variant:"caption",children:"Nombre del usuario"}),e.jsx(T,{mt:1,color:"black",children:d})]})]}),e.jsxs(N,{children:[e.jsx(j,{size:"small",onClick:l,children:"Cancelar"}),e.jsx(K,{loading:n,variant:"contained",color:"error",size:"small",loadingPosition:"start",disableElevation:!0,autoFocus:!0,onClick:P,children:"Eliminar"})]})]})]})]})}const oe=v("div")(({theme:s})=>({position:"relative",borderRadius:s.shape.borderRadius,backgroundColor:E().palette.mode==="dark"?f(s.palette.common.white,.15):f(s.palette.common.black,.05),"&:hover":{backgroundColor:E().palette.mode==="dark"?f(s.palette.common.white,.25):f(s.palette.common.black,.15)},marginLeft:0,width:"100%",[s.breakpoints.up("sm")]:{marginLeft:s.spacing(1),width:"auto"}})),le=v("div")(({theme:s})=>({padding:s.spacing(0,2),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"})),ce=v(Q)(({theme:s})=>({color:"inherit","& .MuiInputBase-input":{padding:s.spacing(1,1,1,0),paddingLeft:`calc(1em + ${s.spacing(4)})`,transition:s.transitions.create("width"),width:"100%",[s.breakpoints.up("sm")]:{width:"12ch","&:focus":{width:"20ch"}}}}));function de(){var i;const s=D(),[d,m]=$(),[b,p]=g.useState(!1),[n,u]=g.useState({}),[o,h]=g.useState({perPage:parseInt(d.get("perPage")||"10"),page:parseInt(d.get("page")||"0"),q:d.get("q")||""});g.useEffect(()=>{l(o)},[]);const l=({perPage:a,page:t,q:r})=>{p(!0);const y=new URL(`${L}/users`),B={perPage:String(a),page:String(t),q:r};y.search=new URLSearchParams(B).toString(),fetch(y).then(k=>k.json()).then(k=>{u(k)}).finally(()=>p(!1))},P=(a,t)=>{const r={...o,page:t};h(r),l(r),m({perPage:String(r.perPage),page:String(r.page),q:r.q})},C=a=>{const t=parseInt(a.target.value),r={...o,perPage:t,page:0};h(r),l(r),m({perPage:String(r.perPage),page:String(r.page),q:r.q})},S=a=>{const t=a.target.value,r={...o,q:t,page:0};h(r),l(r),m({perPage:String(r.perPage),page:String(r.page),q:r.q})},w=a=>{s(`/admin/users/${a}/edit`)},x=()=>{s("/admin/users/create")};return e.jsx(I,{sx:{width:"100%",position:"relative"},children:e.jsxs(V,{variant:"outlined",sx:{width:"100%",mb:2},children:[e.jsxs(X,{children:[e.jsx(T,{component:"h2",variant:"h5",noWrap:!0,color:"primary",sx:{flexGrow:1,display:{xs:"none",sm:"block"}},children:"Usuarios"}),e.jsxs(I,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(oe,{children:[e.jsx(le,{children:e.jsx(J,{})}),e.jsx(ce,{placeholder:"Buscar…",type:"search",inputProps:{"aria-label":"search"},onChange:S,defaultValue:d.get("q")})]}),e.jsx(j,{size:"small",color:"primary",startIcon:e.jsx(O,{}),onClick:()=>x(),children:"Agregar"})]})]}),b&&e.jsx(Y,{sx:{position:"absolute",top:"0",left:0,right:0,borderRadius:4}}),e.jsx(Z,{children:e.jsxs(ee,{size:"small",children:[e.jsx(ae,{children:e.jsxs(R,{children:[e.jsx(c,{children:"Nombre"}),e.jsx(c,{children:"Correo electrónico"}),e.jsx(c,{children:"Roles"}),e.jsx(c,{align:"right",children:"Acciones"})]})}),e.jsx(re,{children:(i=n==null?void 0:n.data)==null?void 0:i.map(a=>{var t;return e.jsxs(R,{children:[e.jsx(c,{children:a.name}),e.jsx(c,{children:a.email}),e.jsx(c,{children:e.jsx(U,{direction:"row",spacing:1,children:(t=a.roles)==null?void 0:t.map(r=>e.jsx(se,{label:r.name,variant:"outlined",size:"small",color:"primary",sx:{textTransform:"capitalize"}},r.name))})}),e.jsx(c,{children:e.jsxs(U,{direction:"row",spacing:1,justifyContent:"flex-end",children:[e.jsx(j,{size:"small",color:"info",startIcon:e.jsx(W,{}),onClick:()=>w(a.id),children:"Editar"}),e.jsx(ie,{id:a.id,name:a.name,onFinished:()=>l(o)})]})})]},a.id)})})]})}),e.jsx(te,{rowsPerPageOptions:[5,10,25,100],component:"div",count:(n==null?void 0:n.total)||0,rowsPerPage:o.perPage,page:(n==null?void 0:n.page)||0,onPageChange:P,onRowsPerPageChange:C,labelRowsPerPage:"Filas por página:",labelDisplayedRows:({from:a,to:t,count:r})=>`${a}-${t} de ${r}`,showFirstButton:!0,showLastButton:!0,getItemAriaLabel:a=>a==="first"?"Ir a la primera página":a==="last"?"Ir a la última página":a==="next"?"Ir a la página siguiente":"Regresar a la pagina anterior"})]})})}function pe(){return e.jsx(ne,{sx:{mt:4,mb:4},children:e.jsx(de,{})})}function qe(){return e.jsx(H,{title:"Usuarios",children:e.jsx(pe,{})})}export{qe as default};
