import{r as m,u as X,a as Y,_ as V,j as e,i as Z}from"./index-05c6ae28.js";import{r as M,i as H}from"./createSvgIcon-a125bce0.js";import{d as w,a as ee,b as te}from"./LaptopWindows-64f84a21.js";import{a as z}from"./api-8c80c0c6.js";import{f as se,T as ae,a as oe,b as ne,c as U,d as a,e as ie,L as re}from"./TableRow-ac72c64a.js";import{S as le}from"./Stack-55b5f686.js";import{L as F,C as ce}from"./LoadingButton-dcfc96f5.js";import{g as de,E as ue,c as he,a as pe}from"./styled-170c1d38.js";import{g as xe,T as me,P as ge}from"./Typography-0da2af82.js";import{u as ve}from"./common-50238fcf.js";import{C as je}from"./Container-a301d336.js";import{T as fe}from"./Toolbar-2e7cb729.js";import{B as G}from"./Box-d06b8cd3.js";import{T as be,a as Re,b as $,c as I}from"./TabPanel-77b001ac.js";import{B as Te}from"./Backdrop-aa437dc3.js";import{P as Ce}from"./Page-bdffd879.js";import"./KeyboardArrowRight-3481d03f.js";function _e(s){return de("MuiTableFooter",s)}xe("MuiTableFooter",["root"]);const Se=["className","component"],ye=s=>{const{classes:u}=s;return pe({root:["root"]},_e,u)},ke=ue("tfoot",{name:"MuiTableFooter",slot:"Root",overridesResolver:(s,u)=>u.root})({display:"table-footer-group"}),Pe={variant:"footer"},K="tfoot",Le=m.forwardRef(function(u,b){const l=X({props:u,name:"MuiTableFooter"}),{className:g,component:x=K}=l,R=Y(l,Se),v=V({},l,{component:x}),j=ye(v);return e.jsx(se.Provider,{value:Pe,children:e.jsx(ke,V({as:x,className:he(j.root,g),ref:b,role:x===K?null:"rowgroup",ownerState:v},R))})}),De=Le;var O={},Ae=H;Object.defineProperty(O,"__esModule",{value:!0});var Q=O.default=void 0,Ue=Ae(M()),$e=e,Ie=(0,Ue.default)((0,$e.jsx)("path",{d:"m22.7 19-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"}),"Build");Q=O.default=Ie;var N={},Be=H;Object.defineProperty(N,"__esModule",{value:!0});var q=N.default=void 0,ze=Be(M()),Ee=e,Fe=(0,ze.default)((0,Ee.jsx)("path",{d:"M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"}),"Download");q=N.default=Fe;var W={},Me=H;Object.defineProperty(W,"__esModule",{value:!0});var J=W.default=void 0,He=Me(M()),Oe=e,Ne=(0,He.default)((0,Oe.jsx)("path",{d:"M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"}),"Devices");J=W.default=Ne;function B({data:s,deviceType:u,isLoading:b}){var v,j,n,_,d,S,y,T,k,P,L,D,A;const[l,g]=m.useState(null),x=(t,h,f)=>{g(f);const o=new URL(`${z}/blocking/report/customer/download`),i={deviceType:t,name:h};o.search=new URLSearchParams(i).toString();let p="";fetch(o).then(async r=>{const c=r.headers.get("Content-Disposition");return c&&(p=c.split(";")[1].split("=")[1].replaceAll('"',"")),await r.blob()}).then(r=>URL.createObjectURL(r)).then(r=>{Object.assign(document.createElement("a"),{href:r,download:p}).click()}).finally(()=>{g(null)})},R=(t,h)=>{x(u,t,h)};return e.jsx(ae,{sx:{maxHeight:551},children:e.jsxs(oe,{stickyHeader:!0,size:"small",children:[e.jsx(ne,{children:e.jsxs(U,{children:[e.jsx(a,{children:"Cliente"}),e.jsx(a,{align:"right",children:"Facturables"}),e.jsx(a,{align:"right",children:"No Facturables"}),e.jsx(a,{align:"right",children:"APS"}),e.jsx(a,{align:"right",children:"APQ"}),e.jsx(a,{align:"right",children:"SKU Start"}),e.jsx(a,{align:"right",children:"SKU End"}),e.jsx(a,{align:"right",children:"Acciones"})]})}),e.jsx(ie,{children:(v=s==null?void 0:s.activationReport)==null?void 0:v.map((t,h)=>{var f,o,i,p,r,c,C,E;return e.jsxs(U,{children:[e.jsx(a,{component:"th",scope:"row",children:t==null?void 0:t.customerName}),e.jsx(a,{align:"right",children:(f=t==null?void 0:t._sum)==null?void 0:f.billable}),e.jsx(a,{align:"right",children:(o=t==null?void 0:t._sum)==null?void 0:o.nonBillable}),e.jsx(a,{align:"right",children:(i=t==null?void 0:t._sum)==null?void 0:i.billableWeekly}),e.jsx(a,{align:"right",children:(p=t==null?void 0:t._sum)==null?void 0:p.billableBiweekly}),e.jsx(a,{align:"right",children:((r=t==null?void 0:t._sum)==null?void 0:r.skuStartCounter)>=0?(c=t==null?void 0:t._sum)==null?void 0:c.skuStartCounter:0}),e.jsx(a,{align:"right",children:((C=t==null?void 0:t._sum)==null?void 0:C.skuEndCounter)>=0?(E=t==null?void 0:t._sum)==null?void 0:E.skuEndCounter:0}),e.jsx(a,{children:e.jsx(le,{direction:"row",spacing:1,justifyContent:"flex-end",children:e.jsx(F,{size:"small",color:"primary",loadingPosition:"start",startIcon:e.jsx(q,{}),onClick:()=>R(t==null?void 0:t.customerName,h),disabled:l!==null||b,loading:l===h,children:"Exportar (.csv)"})})})]},t==null?void 0:t.customerName)})}),e.jsxs(De,{sx:{left:0,bottom:0,zIndex:2,position:"sticky"},children:[e.jsx(U,{children:e.jsx(a,{colSpan:8,sx:{padding:0}})}),e.jsxs(U,{children:[e.jsx(a,{variant:"head",children:"Totales"}),e.jsx(a,{align:"right",variant:"head",children:(n=(j=s==null?void 0:s.activationReportTotals)==null?void 0:j._sum)==null?void 0:n.billable}),e.jsx(a,{align:"right",variant:"head",children:(d=(_=s==null?void 0:s.activationReportTotals)==null?void 0:_._sum)==null?void 0:d.nonBillable}),e.jsx(a,{align:"right",variant:"head",children:(y=(S=s==null?void 0:s.activationReportTotals)==null?void 0:S._sum)==null?void 0:y.billableWeekly}),e.jsx(a,{align:"right",variant:"head",children:(k=(T=s==null?void 0:s.activationReportTotals)==null?void 0:T._sum)==null?void 0:k.billableBiweekly}),e.jsx(a,{align:"right",variant:"head",children:(L=(P=s==null?void 0:s.skuReportTotals)==null?void 0:P._sum)==null?void 0:L.skuStartCounter}),e.jsx(a,{align:"right",variant:"head",children:(A=(D=s==null?void 0:s.skuReportTotals)==null?void 0:D._sum)==null?void 0:A.skuEndCounter}),e.jsx(a,{align:"right",variant:"head"})]})]})]})})}function qe(){var t,h,f;const s=ve(o=>o.showSnackbar),[u,b]=Z(),[l,g]=m.useState(!1),[x,R]=m.useState(!1),[v,j]=m.useState(!1),[n,_]=m.useState({}),[d,S]=m.useState(u.get("tab")||"all"),y=(o,i)=>{S(i),b({tab:i}),T(i)};m.useEffect(()=>{T(d)},[]);const T=o=>{g(!0);const i=new URL(`${z}/blocking/report/activation`),p={deviceType:o};i.search=new URLSearchParams(p).toString(),fetch(i).then(async r=>await r.json()).then(r=>{_(r)}).finally(()=>g(!1))},k=()=>{R(!0);const o=new URL(`${z}/blocking/report/activation`);fetch(o,{method:"POST"}).then(async i=>await i.json()).then(()=>{T(d),s("El consolidado se generÃ³ correctamente","success")}).finally(()=>R(!1))},P=o=>{j(!0);const i=new URL(`${z}/blocking/report/activation/download`),p={deviceType:o};i.search=new URLSearchParams(p).toString();let r="";fetch(i).then(async c=>{const C=c.headers.get("Content-Disposition");return C&&(r=C.split(";")[1].split("=")[1].replaceAll('"',"")),await c.blob()}).then(c=>URL.createObjectURL(c)).then(c=>{Object.assign(document.createElement("a"),{href:c,download:r}).click()}).finally(()=>{j(!1)})},L=()=>{k()},D=()=>{P(d)},A=o=>{if(o)return new Date(o).toLocaleString("es",{dateStyle:"medium",timeStyle:"short",hour12:!0})};return e.jsxs(je,{sx:{mt:4,mb:4},children:[e.jsxs(fe,{disableGutters:!0,children:[e.jsxs(me,{component:"h2",variant:"h5",noWrap:!0,sx:{flexGrow:1},children:["Consolidado ",A((t=n==null?void 0:n.lastBlockingDeviceImport)==null?void 0:t.createdAt)]}),e.jsxs(G,{sx:{display:"flex",gap:2},children:[e.jsx(F,{size:"small",color:"primary",loadingPosition:"start",startIcon:e.jsx(Q,{}),onClick:()=>L(),disabled:((h=n==null?void 0:n.activationReport)==null?void 0:h.length)!==0,loading:x,children:"Generar"}),e.jsx(F,{size:"small",color:"primary",loadingPosition:"start",startIcon:e.jsx(q,{}),onClick:()=>D(),disabled:l||((f=n==null?void 0:n.activationReport)==null?void 0:f.length)===0,loading:v,children:"Descargar reporte (.xlsx)"})]})]}),e.jsx(ge,{variant:"outlined",sx:{position:"relative"},children:e.jsxs(be,{value:d,children:[e.jsx(G,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Re,{onChange:y,indicatorColor:"secondary",children:[e.jsx($,{icon:e.jsx(J,{}),iconPosition:"start",label:"Todos",value:"all"}),e.jsx($,{icon:e.jsx(w,{}),iconPosition:"start",label:"Android",value:"android"}),e.jsx($,{icon:e.jsx(ee,{}),iconPosition:"start",label:"iOS",value:"ios"}),e.jsx($,{icon:e.jsx(te,{}),iconPosition:"start",label:"Windows",value:"windows"})]})}),l&&e.jsx(re,{sx:{position:"absolute",top:"0",left:0,right:0,borderTopLeftRadius:4,borderTopRightRadius:4,zIndex:3}}),e.jsx(I,{value:"all",sx:{padding:0},children:e.jsx(B,{data:n,deviceType:d,isLoading:l})}),e.jsx(I,{value:"android",sx:{padding:0},children:e.jsx(B,{data:n,deviceType:d,isLoading:l})}),e.jsx(I,{value:"ios",sx:{padding:0},children:e.jsx(B,{data:n,deviceType:d,isLoading:l})}),e.jsx(I,{value:"windows",sx:{padding:0},children:e.jsx(B,{data:n,deviceType:d,isLoading:l})})]})}),e.jsx(Te,{sx:{color:"#fff",zIndex:o=>o.zIndex.drawer+1},open:x,children:e.jsx(ce,{color:"inherit"})})]})}function rt(){return e.jsx(Ce,{title:"Consolidado",children:e.jsx(qe,{})})}export{rt as default};
