import{r as x,u as J,a as K,_ as q,j as e,i as X}from"./index-e06af375.js";import{r as F,i as M}from"./createSvgIcon-af59304e.js";import{d as Y,a as Z,b as ee}from"./LaptopWindows-c24678eb.js";import{a as U}from"./api-ff746449.js";import{f as te,T as se,a as oe,b as ae,c as D,d as o,e as ie,L as ne}from"./TableRow-678e0e34.js";import{S as re}from"./Stack-bbdf002a.js";import{L as z,C as le}from"./LoadingButton-3a7488f1.js";import{g as ce,E as de,c as ue,a as he}from"./styled-bbf70655.js";import{g as pe,T as xe,P as me}from"./Typography-c441fe83.js";import{u as ve}from"./common-5771c6fd.js";import{C as ge}from"./Container-4a502da1.js";import{T as fe}from"./Toolbar-7d3cc063.js";import{B as W}from"./Box-88fb8089.js";import{T as je,a as be,b as A,c as $}from"./TabPanel-23ae88e7.js";import{B as Re}from"./Backdrop-d96c61dd.js";import{P as Te}from"./Page-a29a2f01.js";import"./KeyboardArrowRight-c2d3ced0.js";function Ce(s){return ce("MuiTableFooter",s)}pe("MuiTableFooter",["root"]);const _e=["className","component"],ye=s=>{const{classes:c}=s;return he({root:["root"]},Ce,c)},Se=de("tfoot",{name:"MuiTableFooter",slot:"Root",overridesResolver:(s,c)=>c.root})({display:"table-footer-group"}),Pe={variant:"footer"},V="tfoot",Le=x.forwardRef(function(c,b){const n=J({props:c,name:"MuiTableFooter"}),{className:m,component:u=V}=n,R=K(n,_e),v=q({},n,{component:u}),g=ye(v);return e.jsx(te.Provider,{value:Pe,children:e.jsx(Se,q({as:u,className:ue(g.root,m),ref:b,role:u===V?null:"rowgroup",ownerState:v},R))})}),ke=Le;var E={},De=M;Object.defineProperty(E,"__esModule",{value:!0});var G=E.default=void 0,Ae=De(F()),$e=e,Ie=(0,Ae.default)((0,$e.jsx)("path",{d:"m22.7 19-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"}),"Build");G=E.default=Ie;var H={},Ue=M;Object.defineProperty(H,"__esModule",{value:!0});var O=H.default=void 0,Be=Ue(F()),ze=e,Fe=(0,Be.default)((0,ze.jsx)("path",{d:"M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"}),"Download");O=H.default=Fe;var N={},Me=M;Object.defineProperty(N,"__esModule",{value:!0});var Q=N.default=void 0,Ee=Me(F()),He=e,Oe=(0,Ee.default)((0,He.jsx)("path",{d:"M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"}),"Devices");Q=N.default=Oe;function I({data:s,deviceType:c,isLoading:b}){var v,g,a,S,l,P,L,T,k;const[n,m]=x.useState(null),u=(t,h,C)=>{m(C);const f=new URL(`${U}/blocking/report/customer/download`),j={deviceType:t,name:h};f.search=new URLSearchParams(j).toString();let p="";fetch(f).then(d=>{const i=d.headers.get("Content-Disposition");return i&&(p=i.split(";")[1].split("=")[1].replaceAll('"',"")),d.blob()}).then(d=>URL.createObjectURL(d)).then(d=>{Object.assign(document.createElement("a"),{href:d,download:p}).click()}).finally(()=>{m(null)})},R=(t,h)=>{u(c,t,h)};return e.jsx(se,{sx:{maxHeight:551},children:e.jsxs(oe,{stickyHeader:!0,size:"small",children:[e.jsx(ae,{children:e.jsxs(D,{children:[e.jsx(o,{children:"Cliente"}),e.jsx(o,{align:"right",children:"Facturables"}),e.jsx(o,{align:"right",children:"No Facturables"}),e.jsx(o,{align:"right",children:"APS"}),e.jsx(o,{align:"right",children:"APQ"}),e.jsx(o,{align:"right",children:"Acciones"})]})}),e.jsx(ie,{children:(v=s==null?void 0:s.activationReport)==null?void 0:v.map((t,h)=>{var C,f,j,p;return e.jsxs(D,{children:[e.jsx(o,{component:"th",scope:"row",children:t==null?void 0:t.customerName}),e.jsx(o,{align:"right",children:(C=t==null?void 0:t._sum)==null?void 0:C.billable}),e.jsx(o,{align:"right",children:(f=t==null?void 0:t._sum)==null?void 0:f.nonBillable}),e.jsx(o,{align:"right",children:(j=t==null?void 0:t._sum)==null?void 0:j.billableWeekly}),e.jsx(o,{align:"right",children:(p=t==null?void 0:t._sum)==null?void 0:p.billableBiweekly}),e.jsx(o,{children:e.jsx(re,{direction:"row",spacing:1,justifyContent:"flex-end",children:e.jsx(z,{size:"small",color:"primary",loadingPosition:"start",startIcon:e.jsx(O,{}),onClick:()=>R(t==null?void 0:t.customerName,h),disabled:n!==null||b,loading:n===h,children:"Exportar (.csv)"})})})]},t==null?void 0:t.customerName)})}),e.jsxs(ke,{sx:{left:0,bottom:0,zIndex:2,position:"sticky"},children:[e.jsx(D,{children:e.jsx(o,{colSpan:6,sx:{padding:0}})}),e.jsxs(D,{children:[e.jsx(o,{variant:"head",children:"Totales"}),e.jsx(o,{align:"right",variant:"head",children:(a=(g=s==null?void 0:s.activationReportTotals)==null?void 0:g._sum)==null?void 0:a.billable}),e.jsx(o,{align:"right",variant:"head",children:(l=(S=s==null?void 0:s.activationReportTotals)==null?void 0:S._sum)==null?void 0:l.nonBillable}),e.jsx(o,{align:"right",variant:"head",children:(L=(P=s==null?void 0:s.activationReportTotals)==null?void 0:P._sum)==null?void 0:L.billableWeekly}),e.jsx(o,{align:"right",variant:"head",children:(k=(T=s==null?void 0:s.activationReportTotals)==null?void 0:T._sum)==null?void 0:k.billableBiweekly}),e.jsx(o,{align:"right",variant:"head"})]})]})]})})}function Ne(){var j,p,d;const s=ve(i=>i.showSnackbar),[c,b]=X(),[n,m]=x.useState(!1),[u,R]=x.useState(!1),[v,g]=x.useState(!1),[a,S]=x.useState({}),[l,P]=x.useState(c.get("tab")||"all"),L=(i,r)=>{P(r),b({tab:r}),T(r)};x.useEffect(()=>{T(l)},[]);const T=i=>{m(!0);const r=new URL(`${U}/blocking/report/activation`),B={deviceType:i};r.search=new URLSearchParams(B).toString(),fetch(r).then(_=>_.json()).then(_=>{S(_)}).finally(()=>m(!1))},k=()=>{R(!0);const i=new URL(`${U}/blocking/report/activation`);fetch(i,{method:"POST"}).then(r=>r.json()).then(()=>{T(l),s("El consolidado se generÃ³ correctamente","success")}).finally(()=>R(!1))},t=i=>{g(!0);const r=new URL(`${U}/blocking/report/activation/download`),B={deviceType:i};r.search=new URLSearchParams(B).toString();let _="";fetch(r).then(y=>{const w=y.headers.get("Content-Disposition");return w&&(_=w.split(";")[1].split("=")[1].replaceAll('"',"")),y.blob()}).then(y=>URL.createObjectURL(y)).then(y=>{Object.assign(document.createElement("a"),{href:y,download:_}).click()}).finally(()=>{g(!1)})},h=()=>{k()},C=()=>{t(l)},f=i=>{if(i)return new Date(i).toLocaleString("es",{dateStyle:"medium",timeStyle:"short",hour12:!0})};return e.jsxs(ge,{sx:{mt:4,mb:4},children:[e.jsxs(fe,{disableGutters:!0,children:[e.jsxs(xe,{component:"h2",variant:"h5",noWrap:!0,sx:{flexGrow:1},children:["Consolidado ",f((j=a==null?void 0:a.lastBlockingDeviceImport)==null?void 0:j.createdAt)]}),e.jsxs(W,{sx:{display:"flex",gap:2},children:[e.jsx(z,{size:"small",color:"primary",loadingPosition:"start",startIcon:e.jsx(G,{}),onClick:()=>h(),disabled:((p=a==null?void 0:a.activationReport)==null?void 0:p.length)!==0,loading:u,children:"Generar"}),e.jsx(z,{size:"small",color:"primary",loadingPosition:"start",startIcon:e.jsx(O,{}),onClick:()=>C(),disabled:n||((d=a==null?void 0:a.activationReport)==null?void 0:d.length)===0,loading:v,children:"Descargar reporte (.xlsx)"})]})]}),e.jsx(me,{variant:"outlined",sx:{position:"relative"},children:e.jsxs(je,{value:l,children:[e.jsx(W,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(be,{onChange:L,indicatorColor:"secondary",children:[e.jsx(A,{icon:e.jsx(Q,{}),iconPosition:"start",label:"Todos",value:"all"}),e.jsx(A,{icon:e.jsx(Y,{}),iconPosition:"start",label:"Android",value:"android"}),e.jsx(A,{icon:e.jsx(Z,{}),iconPosition:"start",label:"iOS",value:"ios"}),e.jsx(A,{icon:e.jsx(ee,{}),iconPosition:"start",label:"Windows",value:"windows"})]})}),n&&e.jsx(ne,{sx:{position:"absolute",top:"0",left:0,right:0,borderRadius:4,zIndex:3}}),e.jsx($,{value:"all",sx:{padding:0},children:e.jsx(I,{data:a,deviceType:l,isLoading:n})}),e.jsx($,{value:"android",sx:{padding:0},children:e.jsx(I,{data:a,deviceType:l,isLoading:n})}),e.jsx($,{value:"ios",sx:{padding:0},children:e.jsx(I,{data:a,deviceType:l,isLoading:n})}),e.jsx($,{value:"windows",sx:{padding:0},children:e.jsx(I,{data:a,deviceType:l,isLoading:n})})]})}),e.jsx(Re,{sx:{color:"#fff",zIndex:i=>i.zIndex.drawer+1},open:u,children:e.jsx(le,{color:"inherit"})})]})}function rt(){return e.jsx(Te,{title:"Consolidado",children:e.jsx(Ne,{})})}export{rt as default};
