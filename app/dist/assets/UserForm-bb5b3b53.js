import{h as N,r as V,j as e}from"./index-feee1ede.js";import{o as d,s as t,a as w,u as G,t as O,C as R}from"./zod-42544938.js";import{u as W}from"./common-306417ae.js";import{a as T}from"./api-df3373fa.js";import{B as $}from"./Box-e6e6a857.js";import{C as J,a as P}from"./CardContent-23585cf5.js";import{G as m,C as A}from"./Grid-011ec995.js";import{T as x,F as H,a as I,b as D}from"./TextField-965f926b.js";import{F as K}from"./FormControlLabel-e714f80b.js";import{C as M}from"./Checkbox-f23d0de7.js";import{B as Q}from"./Page-c0df1b20.js";import{L as X}from"./LoadingButton-5ce2a785.js";const Y=d({name:t({required_error:"Se requiere el nombre"}).nonempty({message:"Se requiere el nombre"}),email:t({required_error:"Se requiere la dirección de correo electrónico"}).nonempty({message:"Se requiere la dirección de correo electrónico"}).email("La dirección de correo electrónico es inválida"),roles:w(d({name:t({required_error:"Se requiere el nombre del rol"})})).nonempty({message:"Se requiere al menos un rol"})}),Z=d({name:t({required_error:"Se requiere el nombre"}).min(1,{message:"Se requiere el nombre"}),email:t({required_error:"Se requiere la dirección de correo electrónico"}).min(1,{message:"Se requiere la dirección de correo electrónico"}).email("La dirección de correo electrónico es inválida"),roles:w(d({name:t({required_error:"Se requiere el nombre del rol"})})).nonempty({message:"Se requiere al menos un rol"}),password:t({required_error:"Se requiere la contraseña"}).nonempty({message:"Se requiere la contraseña"}).min(8,"La contraseña debe tener más de 8 caracteres")});function ue({user:r,roles:u}){var f,h,S,b,j,C,q,y;const p=N(),[L,c]=V.useState(!1),l=W(o=>o.showSnackbar),{control:z,formState:{errors:s},getValues:E,handleSubmit:U,register:g,setValue:v}=G({defaultValues:{name:r==null?void 0:r.name,email:r==null?void 0:r.email,roles:(r==null?void 0:r.roles)||[]},resolver:O(r?Y:Z)}),F=o=>{const{roles:a}=E(),n=a!=null&&a.find(i=>i.name===o.name)?a==null?void 0:a.filter(i=>i.name!==o.name):[...a??[],{name:o.name}];v("roles",n)},_=o=>{r?k(r.id,o):B(o)},k=(o,a)=>{c(!0);const n=new URL(`${T}:3000/api/users/${o}`);fetch(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(i=>{if(!i.ok){l("Error al intentar acualizar el usuario","error");return}p("/admin/users"),l("El usuario se actualizó correctamente","success")}).catch(i=>l("Error al intentar acualizar el usuario","error")).finally(()=>c(!1))},B=o=>{c(!0);const a=new URL(`${T}:3000/api/users`);fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(n=>{if(!n.ok){l("Error al intentar crear el usuario","error");return}p("/admin/users"),l("El usuario se creó correctamente","success")}).catch(n=>l("Error al intentar crear el usuario","error")).finally(()=>c(!1))};return e.jsx($,{component:"form",onSubmit:U(_),noValidate:!0,children:e.jsx(J,{variant:"outlined",children:e.jsxs(P,{children:[e.jsxs(m,{container:!0,spacing:3,children:[e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(x,{margin:"normal",required:!0,fullWidth:!0,size:"small",label:"Nombre",autoFocus:!0,autoComplete:"name",error:!!((f=s.name)!=null&&f.message),helperText:!!((h=s.name)!=null&&h.message)&&String(s.name.message),...g("name")})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(x,{margin:"normal",required:!0,fullWidth:!0,size:"small",label:"Correo electrónico",autoComplete:"email",error:!!((S=s.email)!=null&&S.message),helperText:!!((b=s.email)!=null&&b.message)&&String(s.email.message),...g("email")})})]}),!r&&e.jsx(m,{container:!0,spacing:3,children:e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(x,{margin:"normal",required:!0,fullWidth:!0,size:"small",label:"Contraseña",type:"password",error:!!((j=s.password)!=null&&j.message),helperText:!!((C=s.password)!=null&&C.message)&&String(s.password.message),...g("password")})})}),e.jsxs(H,{sx:{m:1.5},variant:"standard",error:!!((q=s.roles)!=null&&q.message),children:[e.jsx(I,{children:"Roles"}),e.jsx(R,{name:"roles",render:()=>{var o;return(o=u==null?void 0:u.data)==null?void 0:o.map(a=>{var n;return e.jsx(K,{sx:{textTransform:"capitalize"},control:e.jsx(M,{size:"small",color:"secondary",onChange:()=>F(a),defaultChecked:!!((n=r==null?void 0:r.roles)!=null&&n.find(i=>i.name===a.name))}),label:a.name},a.id)})},control:z}),e.jsx(D,{children:!!((y=s.roles)!=null&&y.message)&&String(s.roles.message)})]}),e.jsxs(A,{sx:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(Q,{size:"small",onClick:()=>p("/admin/users"),children:"Cancelar"}),e.jsx(X,{loading:L,variant:"contained",size:"small",disableElevation:!0,type:"submit",children:"Guardar"})]})]})})})}export{ue as U};
