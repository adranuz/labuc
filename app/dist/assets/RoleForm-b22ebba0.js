import{q as _,r as B,j as e,s as g,T as G,w as I}from"./index-d910b063.js";import{o as j,s as b,a as N,u as P,t as U,C as V}from"./zod-c60ef88b.js";import{d as $,F as O,C as A}from"./SaveAlt-d9410daf.js";import{d as J}from"./ArrowBack-1462d81c.js";import{u as W}from"./common-67d9a476.js";import{A as C}from"./constants-53c7a41b.js";import{T as H}from"./Toolbar-bb7e79c6.js";import{I as D}from"./Backdrop-6925e10d.js";import{L as K}from"./LoadingButton-54b2c4a2.js";import{C as M,a as Q}from"./CardContent-441a39f3.js";import{G as y}from"./Grid-1fa796df.js";import{T as X,F as Y}from"./TextField-47f91fce.js";import{F as Z,a as ee}from"./FormControl-070dad34.js";const re=j({name:b({required_error:"Se requiere el nombre"}).nonempty({message:"Se requiere el nombre"}),permissions:N(j({action:b({required_error:"Se requiere el nombre del rol"})})).nonempty({message:"Se requiere al menos un permiso"})});function fe({role:s,permissions:c}){var p,h,f,x;const d=_(),[u,l]=B.useState(!1),n=W(a=>a.showSnackbar),{control:S,formState:{errors:i},getValues:T,handleSubmit:k,register:E,setValue:F}=P({defaultValues:{name:s==null?void 0:s.name,permissions:(s==null?void 0:s.permissions)||[]},resolver:U(re)}),R=a=>{const{permissions:r}=T(),o=r!=null&&r.find(t=>t.action===a.action)?r==null?void 0:r.filter(t=>t.action!==a.action):[...r??[],{action:a.action}];F("permissions",o)},L=a=>{s?q(s.id,a):v(a)},q=(a,r)=>{l(!0);const o=new URL(`${C}/roles/${a}`);fetch(o,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(t=>{if(!t.ok){n("Error al intentar actualizar el rol","error");return}d("/admin/roles"),n("El rol se actualizó correctamente","success")}).catch(t=>n("Error al actualizar crear el rol","error")).finally(()=>l(!1))},v=a=>{l(!0);const r=new URL(`${C}/roles`);fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(o=>{if(!o.ok){n("Error al intentar crear el rol","error");return}m(),n("El rol se creó correctamente","success")}).catch(o=>n("Error al intentar crear el rol","error")).finally(()=>l(!1))},z=()=>{m()},w=()=>{m()},m=()=>{d("/admin/roles")};return e.jsxs(g,{component:"form",onSubmit:k(L),noValidate:!0,children:[e.jsxs(H,{disableGutters:!0,children:[e.jsx(D,{size:"large",color:"inherit",sx:{mr:2},onClick:z,children:e.jsx(J,{})}),e.jsx(G,{component:"h2",variant:"h5",noWrap:!0,sx:{flexGrow:1},children:"Role"}),e.jsxs(g,{sx:{display:"flex",gap:2},children:[e.jsx(I,{size:"small",onClick:w,disabled:u,children:"Cancelar"}),e.jsx(K,{variant:"contained",size:"small",loadingPosition:"start",disableElevation:!0,startIcon:e.jsx($,{}),type:"submit",disabled:u,children:"Guardar"})]})]}),e.jsx(M,{variant:"outlined",children:e.jsxs(Q,{children:[e.jsx(y,{container:!0,spacing:3,children:e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(X,{margin:"normal",required:!0,fullWidth:!0,size:"small",label:"Nombre",autoFocus:!0,autoComplete:"name",error:!!((p=i.name)!=null&&p.message),helperText:!!((h=i.name)!=null&&h.message)&&String(i.name.message),...E("name")})})}),e.jsxs(Z,{sx:{m:1.5},variant:"standard",error:!!((f=i.permissions)!=null&&f.message),children:[e.jsx(ee,{children:"Permisos"}),e.jsx(V,{name:"permissions",render:()=>{var a;return(a=c==null?void 0:c.data)==null?void 0:a.map(r=>{var o;return e.jsx(O,{control:e.jsx(A,{size:"small",color:"secondary",onChange:()=>R(r),defaultChecked:!!((o=s==null?void 0:s.permissions)!=null&&o.find(t=>t.action===r.action))}),label:r.action},r.id)})},control:S}),e.jsx(Y,{children:!!((x=i.permissions)!=null&&x.message)&&String(i.permissions.message)})]})]})})]})}export{fe as R};
