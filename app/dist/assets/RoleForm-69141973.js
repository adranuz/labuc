import{h as z,r as R,j as a}from"./index-34ad4850.js";import{o as h,s as x,a as k,u as w,t as B,C as N}from"./zod-000b1e5e.js";import{u as U}from"./common-06c0ba0d.js";import{L as V,a as g}from"./api-27aaaf1f.js";import{B as _}from"./Box-75332173.js";import{C as G,a as O}from"./CardContent-5eeabc93.js";import{G as C}from"./Grid-76207fb7.js";import{T as $,F as J,a as P,b as A}from"./TextField-54995e8a.js";import{F as H}from"./FormControlLabel-47f1baff.js";import{C as I}from"./Checkbox-e2aefb59.js";import{C as W}from"./CardActions-47a04fee.js";import{B as D}from"./Page-71ea8f73.js";const K=h({name:x({required_error:"Se requiere el nombre"}).nonempty({message:"Se requiere el nombre"}),permissions:k(h({action:x({required_error:"Se requiere el nombre del rol"})})).nonempty({message:"Se requiere al menos un permiso"})});function ie({role:s,permissions:m}){var d,u,p,f;const c=z(),[j,l]=R.useState(!1),n=U(r=>r.showSnackbar),{control:b,formState:{errors:i},getValues:y,handleSubmit:S,register:T,setValue:E}=w({defaultValues:{name:s==null?void 0:s.name,permissions:(s==null?void 0:s.permissions)||[]},resolver:B(K)}),F=r=>{const{permissions:e}=y(),o=e!=null&&e.find(t=>t.action===r.action)?e==null?void 0:e.filter(t=>t.action!==r.action):[...e??[],{action:r.action}];E("permissions",o)},L=r=>{s?q(s.id,r):v(r)},q=(r,e)=>{l(!0);const o=new URL(`${g}/roles/${r}`);fetch(o,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(t=>{if(!t.ok){n("Error al intentar actualizar el rol","error");return}c("/admin/roles"),n("El rol se actualizó correctamente","success")}).catch(t=>n("Error al actualizar crear el rol","error")).finally(()=>l(!1))},v=r=>{l(!0);const e=new URL(`${g}/roles`);fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(o=>{if(!o.ok){n("Error al intentar crear el rol","error");return}c("/admin/roles"),n("El rol se creó correctamente","success")}).catch(o=>n("Error al intentar crear el rol","error")).finally(()=>l(!1))};return a.jsx(_,{component:"form",onSubmit:S(L),noValidate:!0,children:a.jsxs(G,{variant:"outlined",children:[a.jsxs(O,{children:[a.jsx(C,{container:!0,spacing:3,children:a.jsx(C,{item:!0,xs:12,md:6,children:a.jsx($,{margin:"normal",required:!0,fullWidth:!0,size:"small",label:"Nombre",autoFocus:!0,autoComplete:"name",error:!!((d=i.name)!=null&&d.message),helperText:!!((u=i.name)!=null&&u.message)&&String(i.name.message),...T("name")})})}),a.jsxs(J,{sx:{m:1.5},variant:"standard",error:!!((p=i.permissions)!=null&&p.message),children:[a.jsx(P,{children:"Permisos"}),a.jsx(N,{name:"permissions",render:()=>{var r;return(r=m==null?void 0:m.data)==null?void 0:r.map(e=>{var o;return a.jsx(H,{control:a.jsx(I,{size:"small",color:"secondary",onChange:()=>F(e),defaultChecked:!!((o=s==null?void 0:s.permissions)!=null&&o.find(t=>t.action===e.action))}),label:e.action},e.id)})},control:b}),a.jsx(A,{children:!!((f=i.permissions)!=null&&f.message)&&String(i.permissions.message)})]})]}),a.jsxs(W,{sx:{display:"flex",justifyContent:"flex-end"},children:[a.jsx(D,{size:"small",onClick:()=>c("/admin/roles"),children:"Cancelar"}),a.jsx(V,{loading:j,variant:"contained",size:"small",disableElevation:!0,type:"submit",children:"Guardar"})]})]})})}export{ie as R};
