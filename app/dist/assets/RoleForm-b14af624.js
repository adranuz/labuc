import{f as w,r as _,j as e}from"./index-3b2b324b.js";import{o as g,s as j,a as G,u as I,t as N,C as U}from"./zod-617a0a42.js";import{d as V,C as $}from"./SaveAlt-a5bc8d0c.js";import{d as O,F as P}from"./ArrowBack-1dc0e8c2.js";import{u as J}from"./common-9cf73853.js";import{a as b}from"./api-ff746449.js";import{B as C}from"./Box-5e0d6611.js";import{T as W}from"./Toolbar-485db5b6.js";import{I as H}from"./Menu-7587e473.js";import{T as A}from"./Typography-26330211.js";import{B as D}from"./Page-f1507415.js";import{L as K}from"./LoadingButton-3db6a78e.js";import{C as M,a as Q}from"./CardContent-dab4c059.js";import{G as y}from"./Grid-92ba5a9d.js";import{T as X,F as Y,a as Z,b as ee}from"./TextField-b8fb4249.js";const re=g({name:j({required_error:"Se requiere el nombre"}).nonempty({message:"Se requiere el nombre"}),permissions:G(g({action:j({required_error:"Se requiere el nombre del rol"})})).nonempty({message:"Se requiere al menos un permiso"})});function ge({role:o,permissions:m}){var p,f,h,x;const d=w(),[u,l]=_.useState(!1),n=J(a=>a.showSnackbar),{control:S,formState:{errors:i},getValues:T,handleSubmit:k,register:E,setValue:F}=I({defaultValues:{name:o==null?void 0:o.name,permissions:(o==null?void 0:o.permissions)||[]},resolver:N(re)}),R=a=>{const{permissions:r}=T(),s=r!=null&&r.find(t=>t.action===a.action)?r==null?void 0:r.filter(t=>t.action!==a.action):[...r??[],{action:a.action}];F("permissions",s)},v=a=>{o?z(o.id,a):L(a)},z=(a,r)=>{l(!0);const s=new URL(`${b}/roles/${a}`);fetch(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(t=>{if(!t.ok){n("Error al intentar actualizar el rol","error");return}d("/admin/roles"),n("El rol se actualizó correctamente","success")}).catch(t=>n("Error al actualizar crear el rol","error")).finally(()=>l(!1))},L=a=>{l(!0);const r=new URL(`${b}/roles`);fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(s=>{if(!s.ok){n("Error al intentar crear el rol","error");return}c(),n("El rol se creó correctamente","success")}).catch(s=>n("Error al intentar crear el rol","error")).finally(()=>l(!1))},q=()=>{c()},B=()=>{c()},c=()=>{d("/admin/roles")};return e.jsxs(C,{component:"form",onSubmit:k(v),noValidate:!0,children:[e.jsxs(W,{disableGutters:!0,children:[e.jsx(H,{size:"large",color:"inherit",sx:{mr:2},onClick:q,children:e.jsx(O,{})}),e.jsx(A,{component:"h1",variant:"h6",noWrap:!0,sx:{flexGrow:1},children:"Role"}),e.jsxs(C,{sx:{display:"flex",gap:2},children:[e.jsx(D,{size:"small",onClick:B,disabled:u,children:"Cancelar"}),e.jsx(K,{variant:"contained",size:"small",loadingPosition:"start",disableElevation:!0,startIcon:e.jsx(V,{}),type:"submit",disabled:u,children:"Guardar"})]})]}),e.jsx(M,{variant:"outlined",children:e.jsxs(Q,{children:[e.jsx(y,{container:!0,spacing:3,children:e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(X,{margin:"normal",required:!0,fullWidth:!0,size:"small",label:"Nombre",autoFocus:!0,autoComplete:"name",error:!!((p=i.name)!=null&&p.message),helperText:!!((f=i.name)!=null&&f.message)&&String(i.name.message),...E("name")})})}),e.jsxs(Y,{sx:{m:1.5},variant:"standard",error:!!((h=i.permissions)!=null&&h.message),children:[e.jsx(Z,{children:"Permisos"}),e.jsx(U,{name:"permissions",render:()=>{var a;return(a=m==null?void 0:m.data)==null?void 0:a.map(r=>{var s;return e.jsx(P,{control:e.jsx($,{size:"small",color:"secondary",onChange:()=>R(r),defaultChecked:!!((s=o==null?void 0:o.permissions)!=null&&s.find(t=>t.action===r.action))}),label:r.action},r.id)})},control:S}),e.jsx(ee,{children:!!((x=i.permissions)!=null&&x.message)&&String(i.permissions.message)})]})]})})]})}export{ge as R};
