import{i as Y,k as H,E as K,r as p,b as Q,c as V,_ as N,j as e,d as q,e as G,x as J,s as X,A as W}from"./index-64ee5db4.js";import{d as O}from"./Download-755992dc.js";import{T as Z}from"./Toolbar-85484bb9.js";import{A as I}from"./constants-2e6fc461.js";import{f as w,T as ee,a as te,b as se,c as B,d as o,e as oe}from"./TableRow-8cb96c2e.js";import{S as ne}from"./Stack-44fd4b01.js";import{L as _}from"./LoadingButton-d1fcde35.js";import{C as ie}from"./Container-5ebdd271.js";import{P as le}from"./Paper-3ba8c3cc.js";import{D as re}from"./DatePicker-f255bc1c.js";import{F as ae,I as ce}from"./FormControl-24d1bd67.js";import{S as de}from"./Select-eabe2e08.js";import{M as F}from"./MenuItem-99edd351.js";import{L as he}from"./LinearProgress-1962e334.js";import{P as pe}from"./Page-9b18e939.js";import"./createSvgIcon-9ace6ece.js";import"./ArrowBack-afe2bf24.js";import"./Toolbar-984ecaee.js";import"./Backdrop-83b371ec.js";import"./Grid-6d55df83.js";import"./TextField-3b5635c4.js";import"./Popper-91005be0.js";import"./Menu-292a1a41.js";import"./InputAdornment-50aee76d.js";import"./DialogActions-38fadaca.js";import"./listItemButtonClasses-845061d1.js";import"./Chip-2f6d8532.js";import"./dividerClasses-f4851a5f.js";function ge(h){return Y("MuiTableFooter",h)}H("MuiTableFooter",["root"]);const ue=["className","component"],me=h=>{const{classes:s}=h;return G({root:["root"]},ge,s)},xe=K("tfoot",{name:"MuiTableFooter",slot:"Root",overridesResolver:(h,s)=>s.root})({display:"table-footer-group"}),fe={variant:"footer"},z="tfoot",je=p.forwardRef(function(s,C){const g=Q({props:s,name:"MuiTableFooter"}),{className:R,component:f=z}=g,D=V(g,ue),j=N({},g,{component:f}),u=me(j);return e.jsx(w.Provider,{value:fe,children:e.jsx(xe,N({as:f,className:q(u.root,R),ref:C,role:f===z?null:"rowgroup",ownerState:j},D))})}),be=je;function ve({id:h,data:s,deviceType:C}){var j,u,T,m,y,a,k;const[g,R]=p.useState(null),f=(t,b,S,E)=>{R(E);const P=new URL(`${I}/blocking/reports/${t}/customers/${S}/download`),L={deviceType:b};P.search=new URLSearchParams(L).toString();let A="";fetch(P).then(async v=>{const U=v.headers.get("Content-Disposition");return U&&(A=U.split(";")[1].split("=")[1].replaceAll('"',"")),await v.blob()}).then(v=>URL.createObjectURL(v)).then(v=>{Object.assign(document.createElement("a"),{href:v,download:A}).click()}).finally(()=>{R(null)})},D=(t,b)=>{f(h,C,t,b)};return e.jsx(ee,{sx:{maxHeight:638},children:e.jsxs(te,{stickyHeader:!0,size:"small",children:[e.jsx(se,{children:e.jsxs(B,{children:[e.jsx(o,{children:"Cliente"}),e.jsx(o,{align:"right",children:"Facturables"}),e.jsx(o,{align:"right",children:"No Facturables"}),e.jsx(o,{align:"right",children:"APS"}),e.jsx(o,{align:"right",children:"APQ"}),e.jsx(o,{align:"right",children:"SKU Start"}),e.jsx(o,{align:"right",children:"SKU End"}),e.jsx(o,{align:"right",children:"Acciones"})]})}),e.jsx(oe,{children:(j=s==null?void 0:s.customers)==null?void 0:j.map((t,b)=>{var S;return e.jsxs(B,{hover:!0,children:[e.jsx(o,{component:"th",scope:"row",children:t==null?void 0:t.customerName}),e.jsx(o,{align:"right",children:t==null?void 0:t.billable}),e.jsx(o,{align:"right",children:t==null?void 0:t.nonBillable}),e.jsx(o,{align:"right",children:t==null?void 0:t.billableWeekly}),e.jsx(o,{align:"right",children:t==null?void 0:t.billableBiweekly}),e.jsx(o,{align:"right",children:t==null?void 0:t.skuStartCounter}),e.jsx(o,{align:"right",children:t==null?void 0:t.skuEndCounter}),e.jsx(o,{children:e.jsx(ne,{direction:"row",spacing:1,justifyContent:"flex-end",children:e.jsx(_,{size:"small",color:"primary",loadingPosition:"start",startIcon:e.jsx(O,{}),onClick:()=>D(t==null?void 0:t.customerName,b),disabled:g!==null||!((S=s==null?void 0:s.extra)!=null&&S.allowDownloadCustomerReport),loading:g===b,children:"Exportar (.csv)"})})})]},t==null?void 0:t.customerName)})}),e.jsxs(be,{sx:{left:0,bottom:0,zIndex:2,position:"sticky"},children:[e.jsx(B,{children:e.jsx(o,{colSpan:8,sx:{padding:0}})}),e.jsxs(B,{children:[e.jsx(o,{variant:"head",children:"Totales"}),e.jsx(o,{align:"right",variant:"head",children:(u=s==null?void 0:s.totals)==null?void 0:u.billable}),e.jsx(o,{align:"right",variant:"head",children:(T=s==null?void 0:s.totals)==null?void 0:T.nonBillable}),e.jsx(o,{align:"right",variant:"head",children:(m=s==null?void 0:s.totals)==null?void 0:m.billableWeekly}),e.jsx(o,{align:"right",variant:"head",children:(y=s==null?void 0:s.totals)==null?void 0:y.billableBiweekly}),e.jsx(o,{align:"right",variant:"head",children:(a=s==null?void 0:s.totals)==null?void 0:a.skuStartCounter}),e.jsx(o,{align:"right",variant:"head",children:(k=s==null?void 0:s.totals)==null?void 0:k.skuEndCounter}),e.jsx(o,{align:"right",variant:"head"})]})]})]})})}function Ce(){var $;const[h,s]=J(),[C,g]=p.useState(!1),[R,f]=p.useState(!1),[D,j]=p.useState(!1),[u,T]=p.useState({}),[m,y]=p.useState({}),[a,k]=p.useState({}),[t,b]=p.useState(h.get("device")??"all"),S=c=>{var n;const l=c.target.value;b(l),s({reportedAt:(n=a.reportedAt)==null?void 0:n.slice(0,10),device:l}),L(a.id,l)},E=c=>{var d;const l=W(c).format("YYYY-MM-DD"),n=(d=m==null?void 0:m.data)==null?void 0:d.find(r=>{var i;return((i=r.reportedAt)==null?void 0:i.slice(0,10))===l});n&&(k(n),L(n.id,t),s({reportedAt:l,device:t}))};p.useEffect(()=>{P()},[]);const P=()=>{f(!0);const c=new URL(`${I}/blocking/reports`),l=[["pagination","false"],["includeConsolidated","false"],["fields[]","id"],["fields[]","reportedAt"]];c.search=new URLSearchParams(l).toString(),fetch(c).then(async n=>await n.json()).then(n=>{var i;y(n);const d=h.get("reportedAt"),r=(i=n==null?void 0:n.data)==null?void 0:i.find(x=>{var M;return d===null?(x==null?void 0:x.reportedAt)!==null:(M=x==null?void 0:x.reportedAt)==null?void 0:M.startsWith(d)});r&&(k(r),L(r.id,t))}).finally(()=>{f(!1)})},L=(c,l)=>{g(!0);const n=new URL(`${I}/blocking/reports/${c}/consolidated`),d={deviceType:l};n.search=new URLSearchParams(d).toString(),fetch(n).then(async r=>await r.json()).then(r=>{T(r)}).finally(()=>g(!1))},A=(c,l)=>{j(!0);const n=new URL(`${I}/blocking/reports/${c}/consolidated/download`),d={deviceType:l};n.search=new URLSearchParams(d).toString();let r="";fetch(n).then(async i=>{const x=i.headers.get("Content-Disposition");return x&&(r=x.split(";")[1].split("=")[1].replaceAll('"',"")),await i.blob()}).then(i=>URL.createObjectURL(i)).then(i=>{Object.assign(document.createElement("a"),{href:i,download:r}).click()}).finally(()=>{j(!1)})},v=()=>{A(a==null?void 0:a.id,t)},U=c=>{var d;const l=c.toISOString().slice(0,10);return!((d=m==null?void 0:m.data)==null?void 0:d.some(r=>{var i;return((i=r.reportedAt)==null?void 0:i.slice(0,10))===l}))};return e.jsx(ie,{sx:{mt:4,mb:4},children:e.jsx(X,{sx:{width:"100%",position:"relative"},children:e.jsxs(le,{variant:"outlined",sx:{width:"100%",mb:2,pt:1},children:[e.jsxs(Z,{title:"Consolidado",children:[e.jsx(re,{value:(a==null?void 0:a.reportedAt)&&W(a.reportedAt.slice(0,10)),label:"Fecha del reporte",slotProps:{textField:{size:"small"}},shouldDisableDate:U,onChange:E,sx:{maxWidth:190}}),e.jsxs(ae,{margin:"none",size:"small",sx:{minWidth:120},children:[e.jsx(ce,{children:"Dispositivos"}),e.jsxs(de,{label:"Dispositivos",defaultValue:"all",onChange:S,children:[e.jsx(F,{value:"all",children:"Todos"}),e.jsx(F,{value:"android",children:"Android"}),e.jsx(F,{value:"ios",children:"iOS"}),e.jsx(F,{value:"windows",children:"Windows"})]})]}),e.jsx(_,{size:"small",color:"primary",loadingPosition:"start",startIcon:e.jsx(O,{}),onClick:()=>v(),disabled:C||R||(($=u==null?void 0:u.blockingDeviceConsolidatedReport)==null?void 0:$.length)===0,loading:D,children:"Descargar reporte (.xlsx)"})]}),(C||R)&&e.jsx(he,{sx:{position:"absolute",top:"0",left:0,right:0,borderTopLeftRadius:4,borderTopRightRadius:4}}),e.jsx(ve,{id:a.id,data:u,deviceType:t})]})})})}function Je(){return e.jsx(pe,{title:"Consolidado",children:e.jsx(Ce,{})})}export{Je as default};
