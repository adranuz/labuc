import{x as B,j as e,r as x,A as E}from"./index-32292c13.js";import{T as y}from"./Toolbar-d70cb619.js";import{d as N}from"./Download-3b7b28ef.js";import{l as W}from"./utils-ae6c9da2.js";import{u as z}from"./pac-380c4ae9.js";import{T as _,a as H,b as V,c as I,d as m,e as G}from"./TableRow-2aaefee4.js";import{C as J}from"./Chip-94effd15.js";import{T as K}from"./TablePagination-b1f8bda9.js";import{A as Q}from"./constants-a5768e35.js";import{C as X}from"./Container-430f5354.js";import{P as Z}from"./Paper-d19b285b.js";import{D as v}from"./DatePicker-8a2cb260.js";import{F as ee,I as te}from"./FormControl-1302c8b4.js";import{S as ae}from"./Select-1f7de27f.js";import{M as A}from"./MenuItem-416c8a5f.js";import{L as se}from"./LoadingButton-e0ccb8bc.js";import{L as re}from"./LinearProgress-2186b45d.js";import{P as oe}from"./Page-163afb69.js";import"./ArrowBack-77e9619e.js";import"./createSvgIcon-abbd2357.js";import"./Toolbar-c06937fa.js";import"./Backdrop-752351c6.js";import"./middleware-4d18dae0.js";import"./KeyboardArrowRight-8567b424.js";import"./Grid-003d548d.js";import"./TextField-dc504966.js";import"./Popper-c4f5970e.js";import"./Menu-3217b6b0.js";import"./InputAdornment-ce6d5b02.js";import"./DialogActions-c49c2bf1.js";import"./listItemButtonClasses-08f4cb3c.js";import"./dividerClasses-39a22909.js";function ne({customerId:a,status:u,startDate:r,endDate:C}){var M;const[s,b]=B(),[P,j,D,d]=z(o=>[o.getCreditReportListFilters,o.setCreditReportListFilters,o.getCreditReportList,o.creditReportList]),n=(o,l)=>{if(a===void 0)return;const c={...P,page:l};j(c),D(a,u,r,C),s.set("page",String(l)),b(s)},p=o=>{if(a===void 0)return;const l=parseInt(o.target.value),c={...P,perPage:l,page:0};j(c),D(a,u,r,C),s.set("perPage",String(l)),b(s)};return e.jsxs(e.Fragment,{children:[e.jsx(_,{children:e.jsxs(H,{size:"small",children:[e.jsx(V,{children:e.jsxs(I,{children:[e.jsx(m,{children:"No. de crédito"}),e.jsx(m,{children:"Marca"}),e.jsx(m,{children:"Modelo"}),e.jsx(m,{children:"IMEI"}),e.jsx(m,{children:"Fecha de venta"}),e.jsx(m,{children:"Estado"})]})}),e.jsx(G,{children:(M=d==null?void 0:d.data)==null?void 0:M.map(({creditId:o,branch:l,model:c,imei:g,saleDate:h,creditStatus:R})=>e.jsxs(I,{hover:!0,children:[e.jsx(m,{children:o}),e.jsx(m,{children:l}),e.jsx(m,{children:c}),e.jsx(m,{children:g}),e.jsx(m,{children:!!h&&W({date:h})}),e.jsx(m,{children:e.jsx(J,{label:R,variant:"outlined",size:"small",color:"info"})})]},o))})]})}),e.jsx(K,{rowsPerPageOptions:[5,10,25,100],component:"div",count:(d==null?void 0:d.total)??0,rowsPerPage:P.perPage,page:(d==null?void 0:d.page)??0,onPageChange:n,onRowsPerPageChange:p,labelRowsPerPage:"Filas por página:",labelDisplayedRows:({from:o,to:l,count:c})=>`${o}-${l} de ${c}`,showFirstButton:!0,showLastButton:!0,getItemAriaLabel:o=>o==="first"?"Ir a la primera página":o==="last"?"Ir a la última página":o==="next"?"Ir a la página siguiente":"Regresar a la pagina anterior"})]})}function ie(){const[a,u]=B(),[r,C]=x.useState(a.get("startDate")?E(a.get("startDate")):null),[s,b]=x.useState(a.get("endDate")?E(a.get("endDate")):null),[P,j]=x.useState(!1),[D,d]=x.useState(!1),n=a.get("customerId")??void 0,[p,M]=x.useState(a.get("status")??void 0),o=[{id:"ANUL",name:"Anulados"},{id:"CANC",name:"Cancelados"},{id:"PEND",name:"Pendientes"},{id:"MORA",name:"Mora"}],[l,c,g,h]=z(t=>[t.getCreditReportListFilters,t.setCreditReportListFilters,t.getCreditReportList,t.getCreditReportListLoading]),R=t=>{C(t),t!==null?a.set("startDate",t.format("YYYY-MM-DD")):a.delete("startDate"),a.set("page","0"),u(a);const i={...l,page:0};c(i),t&&s&&n&&g(n,p,t.format("YYYY-MM-DD"),s.format("YYYY-MM-DD")),t===null&&s==null&&n&&g(n,p)},k=t=>{b(t),t!==null?a.set("endDate",t.format("YYYY-MM-DD")):a.delete("endDate"),a.set("page","0"),u(a);const i={...l,page:0};c(i),r&&t&&n&&g(n,p,r.format("YYYY-MM-DD"),t.format("YYYY-MM-DD")),r===null&&t==null&&n&&g(n,p)},O=t=>{const i=t.target.value;M(i),console.log(i),a.set("status",i),a.set("page","0"),u(a);const f={...l,page:0};c(f),n&&g(n,i,r==null?void 0:r.format("YYYY-MM-DD"),s==null?void 0:s.format("YYYY-MM-DD"))},U=()=>{$(n,p,r==null?void 0:r.format("YYYY-MM-DD"),s==null?void 0:s.format("YYYY-MM-DD"))},$=(t,i,f,F)=>{d(!0);const w=new URL(`${Q}/pac/customers/${t}/credit/report/download`),L={};Object.assign(L,i&&{status:i},f&&F&&{startDate:f,endDate:F}),w.search=new URLSearchParams(L).toString();let S="";fetch(w).then(async Y=>{const T=Y.headers.get("Content-Disposition");return T&&(S=T.split(";")[1].split("=")[1].replaceAll('"',"")),await Y.blob()}).then(Y=>URL.createObjectURL(Y)).then(Y=>{Object.assign(document.createElement("a"),{href:Y,download:S}).click()}).finally(()=>{d(!1)})},q=t=>t.isBefore(r);return x.useEffect(()=>{if(n===void 0)return;const t=a.get("perPage"),i=a.get("page"),f=a.get("q");c({perPage:t!==null?parseInt(t):10,page:i!==null?parseInt(i):0,q:f?l.q:""}),console.log("setSearchParams"),console.log(a.values()),g(n,p,r==null?void 0:r.format("YYYY-MM-DD"),s==null?void 0:s.format("YYYY-MM-DD"))},[]),e.jsx(X,{sx:{mt:4,mb:4},children:e.jsxs(Z,{variant:"outlined",sx:{width:"100%",mb:2,pt:1,position:"relative"},children:[e.jsxs(y,{title:"Reporte de créditos PAC",pathRouteForBackButton:`/tool/pac/credits?customerId=${n}`,children:[e.jsx(v,{value:r,onChange:R,label:"Fecha de inicio",slotProps:{actionBar:{actions:["clear"]},textField:r===null&&s!==null?{size:"small",error:!0}:{size:"small"}},disableFuture:!0,sx:{maxWidth:180},disabled:h}),e.jsx(v,{value:s,open:P,onChange:k,onClose:()=>{j(!1)},onOpen:()=>{j(!0)},label:"Fecha de fin",slotProps:{actionBar:{actions:["clear"]},textField:r!==null&&s===null?{size:"small",error:!0}:{size:"small"}},disableFuture:!0,shouldDisableDate:q,sx:{maxWidth:180},disabled:h}),e.jsxs(ee,{margin:"none",size:"small",sx:{minWidth:135},disabled:h,children:[e.jsx(te,{children:"Estado"}),e.jsxs(ae,{label:"Estado",onChange:O,defaultValue:p,children:[e.jsx(A,{value:void 0,children:e.jsx("em",{children:"Todos"})}),o==null?void 0:o.map(({id:t,name:i})=>e.jsx(A,{value:t,children:i},t))]})]}),e.jsx(se,{size:"small",color:"primary",loadingPosition:"start",startIcon:e.jsx(N,{}),onClick:()=>U(),disabled:h||D,loading:D,children:"Descargar (.csv)"})]}),h&&e.jsx(re,{sx:{position:"absolute",top:"0",left:0,right:0,borderTopLeftRadius:4,borderTopRightRadius:4}}),e.jsx(ne,{customerId:n,status:p,startDate:r==null?void 0:r.format("YYYY-MM-DD"),endDate:s==null?void 0:s.format("YYYY-MM-DD")})]})})}function qe(){return e.jsx(oe,{title:"Reporte de créditos PAC",children:e.jsx(ie,{})})}export{qe as default};
