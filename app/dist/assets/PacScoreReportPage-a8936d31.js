import{x as k,j as e,r as Y,A as B}from"./index-32292c13.js";import{T as q}from"./Toolbar-d70cb619.js";import{d as N}from"./Download-3b7b28ef.js";import{l as W}from"./utils-ae6c9da2.js";import{u as O}from"./pac-380c4ae9.js";import{B as _}from"./BooleanIndicator-1a20fded.js";import{T as H,a as V,b as G,c as E,d as l,e as J}from"./TableRow-2aaefee4.js";import{C as K}from"./Chip-94effd15.js";import{T as Q}from"./TablePagination-b1f8bda9.js";import{A as X}from"./constants-a5768e35.js";import{C as Z}from"./Container-430f5354.js";import{P as ee}from"./Paper-d19b285b.js";import{F as te,I as re}from"./FormControl-1302c8b4.js";import{S as ae}from"./Select-1f7de27f.js";import{M as A}from"./MenuItem-416c8a5f.js";import{L as oe}from"./LoadingButton-e0ccb8bc.js";import{L as se}from"./LinearProgress-2186b45d.js";import{D as z}from"./DatePicker-8a2cb260.js";import{P as ne}from"./Page-163afb69.js";import"./ArrowBack-77e9619e.js";import"./createSvgIcon-abbd2357.js";import"./Toolbar-c06937fa.js";import"./Backdrop-752351c6.js";import"./middleware-4d18dae0.js";import"./Close-22468df7.js";import"./Tooltip-64f1a3d2.js";import"./Popper-c4f5970e.js";import"./KeyboardArrowRight-8567b424.js";import"./Menu-3217b6b0.js";import"./dividerClasses-39a22909.js";import"./Grid-003d548d.js";import"./TextField-dc504966.js";import"./InputAdornment-ce6d5b02.js";import"./DialogActions-c49c2bf1.js";import"./listItemButtonClasses-08f4cb3c.js";function ie({customerId:r,status:u,startDate:o,endDate:b}){var R;const[a,S]=k(),[j,P,D,d]=O(s=>[s.getScoreReportListFilters,s.setScoreReportListFilters,s.getScoreReportList,s.scoreReportList]),n=(s,c)=>{if(r===void 0)return;const p={...j,page:c};P(p),D(r,u,o,b),a.set("page",String(c)),S(a)},m=s=>{if(r===void 0)return;const c=parseInt(s.target.value),p={...j,perPage:c,page:0};P(p),D(r,u,o,b),a.set("perPage",String(c)),S(a)};return e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsxs(V,{size:"small",children:[e.jsx(G,{children:e.jsxs(E,{children:[e.jsx(l,{children:"No. de crédito"}),e.jsx(l,{children:"Referencia"}),e.jsx(l,{children:"No. Solicitud"}),e.jsx(l,{children:"Fecha"}),e.jsx(l,{children:"Estado"}),e.jsx(l,{align:"center",children:"Score"}),e.jsx(l,{align:"center",children:"Dispositivo validado previamente"}),e.jsx(l,{children:"ID de dispositivo"})]})}),e.jsx(J,{children:(R=d==null?void 0:d.data)==null?void 0:R.map(({status:s,creditId:c,previouslyValidatedDevice:p,reference:g,requestDate:h,requestId:M,score:w,deviceId:F})=>e.jsxs(E,{hover:!0,children:[e.jsx(l,{children:c}),e.jsx(l,{children:g}),e.jsx(l,{children:M}),e.jsx(l,{children:!!h&&W({date:h})}),e.jsx(l,{children:e.jsx(K,{label:s,variant:"outlined",size:"small",color:s==="Aceptado"?"success":"warning"})}),e.jsx(l,{align:"center",children:w}),e.jsx(l,{align:"center",children:e.jsx(_,{value:p==="Si"})}),e.jsx(l,{children:F})]},c))})]})}),e.jsx(Q,{rowsPerPageOptions:[5,10,25,100],component:"div",count:(d==null?void 0:d.total)??0,rowsPerPage:j.perPage,page:(d==null?void 0:d.page)??0,onPageChange:n,onRowsPerPageChange:m,labelRowsPerPage:"Filas por página:",labelDisplayedRows:({from:s,to:c,count:p})=>`${s}-${c} de ${p}`,showFirstButton:!0,showLastButton:!0,getItemAriaLabel:s=>s==="first"?"Ir a la primera página":s==="last"?"Ir a la última página":s==="next"?"Ir a la página siguiente":"Regresar a la pagina anterior"})]})}function le(){const[r,u]=k(),[o,b]=Y.useState(r.get("startDate")?B(r.get("startDate")):null),[a,S]=Y.useState(r.get("endDate")?B(r.get("endDate")):null),[j,P]=Y.useState(!1),[D,d]=Y.useState(!1),n=r.get("customerId")??void 0,[m,R]=Y.useState(r.get("status")??void 0),s=[{id:"accepted",name:"Aceptado"},{id:"notAccepted",name:"No aceptado"}],[c,p,g,h]=O(t=>[t.getScoreReportListFilters,t.setScoreReportListFilters,t.getScoreReportList,t.getScoreReportListLoading]),M=t=>{b(t),t!==null?r.set("startDate",t.format("YYYY-MM-DD")):r.delete("startDate"),r.set("page","0"),u(r);const i={...c,page:0};p(i),t&&a&&n&&g(n,m,t.format("YYYY-MM-DD"),a.format("YYYY-MM-DD")),t===null&&a==null&&n&&g(n,m)},w=t=>{S(t),t!==null?r.set("endDate",t.format("YYYY-MM-DD")):r.delete("endDate"),r.set("page","0"),u(r);const i={...c,page:0};p(i),o&&t&&n&&g(n,m,o.format("YYYY-MM-DD"),t.format("YYYY-MM-DD")),o===null&&t==null&&n&&g(n,m)},F=t=>{const i=t.target.value;R(i),console.log(i),r.set("status",i),r.set("page","0"),u(r);const f={...c,page:0};p(f),n&&g(n,i,o==null?void 0:o.format("YYYY-MM-DD"),a==null?void 0:a.format("YYYY-MM-DD"))},$=()=>{U(n,m,o==null?void 0:o.format("YYYY-MM-DD"),a==null?void 0:a.format("YYYY-MM-DD"))},U=(t,i,f,C)=>{d(!0);const L=new URL(`${X}/pac/customers/${t}/score/report/download`),T={};Object.assign(T,i&&{status:i},f&&C&&{startDate:f,endDate:C}),L.search=new URLSearchParams(T).toString();let v="";fetch(L).then(async x=>{const I=x.headers.get("Content-Disposition");return I&&(v=I.split(";")[1].split("=")[1].replaceAll('"',"")),await x.blob()}).then(x=>URL.createObjectURL(x)).then(x=>{Object.assign(document.createElement("a"),{href:x,download:v}).click()}).finally(()=>{d(!1)})},y=t=>t.isBefore(o);return Y.useEffect(()=>{if(n===void 0)return;const t=r.get("perPage"),i=r.get("page"),f=r.get("q");p({perPage:t!==null?parseInt(t):10,page:i!==null?parseInt(i):0,q:f?c.q:""}),console.log("setSearchParams"),console.log(r.values()),g(n,m,o==null?void 0:o.format("YYYY-MM-DD"),a==null?void 0:a.format("YYYY-MM-DD"))},[]),e.jsx(Z,{sx:{mt:4,mb:4},children:e.jsxs(ee,{variant:"outlined",sx:{width:"100%",mb:2,pt:1,position:"relative"},children:[e.jsxs(q,{title:"Reporte de score PAC",pathRouteForBackButton:`/tool/pac/score?customerId=${n}`,children:[e.jsx(z,{value:o,onChange:M,label:"Fecha de inicio",slotProps:{actionBar:{actions:["clear"]},textField:o===null&&a!==null?{size:"small",error:!0}:{size:"small"}},disableFuture:!0,sx:{maxWidth:180},disabled:h}),e.jsx(z,{value:a,open:j,onChange:w,onClose:()=>{P(!1)},onOpen:()=>{P(!0)},label:"Fecha de fin",slotProps:{actionBar:{actions:["clear"]},textField:o!==null&&a===null?{size:"small",error:!0}:{size:"small"}},disableFuture:!0,shouldDisableDate:y,sx:{maxWidth:180},disabled:h}),e.jsxs(te,{margin:"none",size:"small",sx:{minWidth:135},disabled:h,children:[e.jsx(re,{children:"Estado"}),e.jsxs(ae,{label:"Estado",onChange:F,defaultValue:m,children:[e.jsx(A,{value:"",children:e.jsx("em",{children:"Todos"})}),s==null?void 0:s.map(({id:t,name:i})=>e.jsx(A,{value:t,children:i},t))]})]}),e.jsx(oe,{size:"small",color:"primary",loadingPosition:"start",startIcon:e.jsx(N,{}),onClick:()=>$(),disabled:h||D,loading:D,children:"Descargar (.csv)"})]}),h&&e.jsx(se,{sx:{position:"absolute",top:"0",left:0,right:0,borderTopLeftRadius:4,borderTopRightRadius:4}}),e.jsx(ie,{customerId:n,status:m,startDate:o==null?void 0:o.format("YYYY-MM-DD"),endDate:a==null?void 0:a.format("YYYY-MM-DD")})]})})}function _e(){return e.jsx(ne,{title:"Reporte de score de crédito PAC",children:e.jsx(le,{})})}export{_e as default};
