import{f as W,r as $,j as e}from"./index-2f39f1ff.js";import{o as d,s as i,a as L,u as O,t as R,C as J}from"./zod-6557de51.js";import{d as P,C as H}from"./SaveAlt-dca3acdd.js";import{d as A,F as D}from"./ArrowBack-40484030.js";import{u as K}from"./common-2edd7306.js";import{a as U}from"./api-ff746449.js";import{B as z}from"./Box-69448d45.js";import{T as M}from"./Toolbar-89cd294d.js";import{I as Q}from"./Menu-1e9c4500.js";import{T as X}from"./Typography-0d07a002.js";import{B as Y}from"./Page-6a23b43c.js";import{L as Z}from"./LoadingButton-4d47bd0e.js";import{C as ee,a as re}from"./CardContent-e1b514cb.js";import{G as m}from"./Grid-a3a02809.js";import{T as x,F as ae,a as oe,b as se}from"./TextField-0ee35791.js";const ne=d({name:i({required_error:"Se requiere el nombre"}).nonempty({message:"Se requiere el nombre"}),email:i({required_error:"Se requiere la dirección de correo electrónico"}).nonempty({message:"Se requiere la dirección de correo electrónico"}).email("La dirección de correo electrónico es inválida"),roles:L(d({name:i({required_error:"Se requiere el nombre del rol"})})).nonempty({message:"Se requiere al menos un rol"})}),te=d({name:i({required_error:"Se requiere el nombre"}).min(1,{message:"Se requiere el nombre"}),email:i({required_error:"Se requiere la dirección de correo electrónico"}).min(1,{message:"Se requiere la dirección de correo electrónico"}).email("La dirección de correo electrónico es inválida"),roles:L(d({name:i({required_error:"Se requiere el nombre del rol"})})).nonempty({message:"Se requiere al menos un rol"}),password:i({required_error:"Se requiere la contraseña"}).nonempty({message:"Se requiere la contraseña"}).min(8,"La contraseña debe tener más de 8 caracteres")});function qe({user:r,roles:u}){var b,S,j,C,q,y,T,w;const f=W(),[g,c]=$.useState(!1),l=K(o=>o.showSnackbar),{control:_,formState:{errors:s},getValues:k,handleSubmit:v,register:p,setValue:E}=O({defaultValues:{name:r==null?void 0:r.name,email:r==null?void 0:r.email,roles:(r==null?void 0:r.roles)||[]},resolver:R(r?ne:te)}),F=o=>{const{roles:a}=k(),n=a!=null&&a.find(t=>t.name===o.name)?a==null?void 0:a.filter(t=>t.name!==o.name):[...a??[],{name:o.name}];E("roles",n)},B=o=>{r?G(r.id,o):I(o)},G=(o,a)=>{c(!0);const n=new URL(`${U}/users/${o}`);fetch(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(t=>{if(!t.ok){l("Error al intentar acualizar el usuario","error");return}f("/admin/users"),l("El usuario se actualizó correctamente","success")}).catch(t=>l("Error al intentar acualizar el usuario","error")).finally(()=>c(!1))},I=o=>{c(!0);const a=new URL(`${U}/users`);fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(n=>{if(!n.ok){l("Error al intentar crear el usuario","error");return}h(),l("El usuario se creó correctamente","success")}).catch(n=>l("Error al intentar crear el usuario","error")).finally(()=>c(!1))},N=()=>{h()},V=()=>{h()},h=()=>{f("/admin/users")};return e.jsxs(z,{component:"form",onSubmit:v(B),noValidate:!0,children:[e.jsxs(M,{disableGutters:!0,children:[e.jsx(Q,{size:"large",color:"inherit",sx:{mr:2},onClick:N,children:e.jsx(A,{})}),e.jsx(X,{component:"h1",variant:"h6",noWrap:!0,sx:{flexGrow:1},children:"Usuario"}),e.jsxs(z,{sx:{display:"flex",gap:2},children:[e.jsx(Y,{size:"small",onClick:V,disabled:g,children:"Cancelar"}),e.jsx(Z,{variant:"contained",size:"small",disableElevation:!0,startIcon:e.jsx(P,{}),type:"submit",disabled:g,children:"Guardar"})]})]}),e.jsx(ee,{variant:"outlined",children:e.jsxs(re,{children:[e.jsxs(m,{container:!0,spacing:3,children:[e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(x,{margin:"normal",required:!0,fullWidth:!0,size:"small",label:"Nombre",autoFocus:!0,autoComplete:"name",error:!!((b=s.name)!=null&&b.message),helperText:!!((S=s.name)!=null&&S.message)&&String(s.name.message),...p("name")})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(x,{margin:"normal",required:!0,fullWidth:!0,size:"small",label:"Correo electrónico",autoComplete:"email",error:!!((j=s.email)!=null&&j.message),helperText:!!((C=s.email)!=null&&C.message)&&String(s.email.message),...p("email"),disabled:!!r})})]}),!r&&e.jsx(m,{container:!0,spacing:3,children:e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(x,{margin:"normal",required:!0,fullWidth:!0,size:"small",label:"Contraseña",type:"password",error:!!((q=s.password)!=null&&q.message),helperText:!!((y=s.password)!=null&&y.message)&&String(s.password.message),...p("password")})})}),e.jsxs(ae,{sx:{m:1.5},variant:"standard",error:!!((T=s.roles)!=null&&T.message),children:[e.jsx(oe,{children:"Roles"}),e.jsx(J,{name:"roles",render:()=>{var o;return(o=u==null?void 0:u.data)==null?void 0:o.map(a=>{var n;return e.jsx(D,{sx:{textTransform:"capitalize"},control:e.jsx(H,{size:"small",color:"secondary",onChange:()=>F(a),defaultChecked:!!((n=r==null?void 0:r.roles)!=null&&n.find(t=>t.name===a.name))}),label:a.name},a.id)})},control:_}),e.jsx(se,{children:!!((w=s.roles)!=null&&w.message)&&String(s.roles.message)})]})]})})]})}export{qe as U};
