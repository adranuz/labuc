import{f as w,r as _,j as e}from"./index-2dbb1652.js";import{o as g,s as j,a as G,u as I,t as N,C as U}from"./zod-855c41dd.js";import{d as V,C as $}from"./SaveAlt-4c673f42.js";import{d as O,F as J}from"./ArrowBack-3531cade.js";import{u as P}from"./common-58346add.js";import{a as b}from"./api-ff746449.js";import{B as C}from"./Box-2b2c394b.js";import{T as W}from"./Toolbar-cb95e5db.js";import{I as H}from"./Menu-c2f3532a.js";import{T as A}from"./Typography-94b0b471.js";import{B as D}from"./Page-d6c42c0d.js";import{L as K}from"./LoadingButton-8732500b.js";import{C as M,a as Q}from"./CardContent-d317f198.js";import{G as y}from"./Grid-8e00a65e.js";import{T as X,F as Y,a as Z,b as ee}from"./TextField-08f9fe99.js";const re=g({name:j({required_error:"Se requiere el nombre"}).nonempty({message:"Se requiere el nombre"}),permissions:G(g({action:j({required_error:"Se requiere el nombre del rol"})})).nonempty({message:"Se requiere al menos un permiso"})});function ge({role:s,permissions:m}){var p,f,h,x;const d=w(),[u,l]=_.useState(!1),n=P(a=>a.showSnackbar),{control:S,formState:{errors:i},getValues:T,handleSubmit:k,register:E,setValue:F}=I({defaultValues:{name:s==null?void 0:s.name,permissions:(s==null?void 0:s.permissions)||[]},resolver:N(re)}),R=a=>{const{permissions:r}=T(),o=r!=null&&r.find(t=>t.action===a.action)?r==null?void 0:r.filter(t=>t.action!==a.action):[...r??[],{action:a.action}];F("permissions",o)},v=a=>{s?z(s.id,a):L(a)},z=(a,r)=>{l(!0);const o=new URL(`${b}/roles/${a}`);fetch(o,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(t=>{if(!t.ok){n("Error al intentar actualizar el rol","error");return}d("/admin/roles"),n("El rol se actualizó correctamente","success")}).catch(t=>n("Error al actualizar crear el rol","error")).finally(()=>l(!1))},L=a=>{l(!0);const r=new URL(`${b}/roles`);fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(o=>{if(!o.ok){n("Error al intentar crear el rol","error");return}c(),n("El rol se creó correctamente","success")}).catch(o=>n("Error al intentar crear el rol","error")).finally(()=>l(!1))},q=()=>{c()},B=()=>{c()},c=()=>{d("/admin/roles")};return e.jsxs(C,{component:"form",onSubmit:k(v),noValidate:!0,children:[e.jsxs(W,{disableGutters:!0,children:[e.jsx(H,{size:"large",color:"inherit",sx:{mr:2},onClick:q,children:e.jsx(O,{})}),e.jsx(A,{component:"h1",variant:"h6",noWrap:!0,sx:{flexGrow:1},children:"Role"}),e.jsxs(C,{sx:{display:"flex",gap:2},children:[e.jsx(D,{size:"small",onClick:B,disabled:u,children:"Cancelar"}),e.jsx(K,{variant:"contained",size:"small",disableElevation:!0,startIcon:e.jsx(V,{}),type:"submit",disabled:u,children:"Guardar"})]})]}),e.jsx(M,{variant:"outlined",children:e.jsxs(Q,{children:[e.jsx(y,{container:!0,spacing:3,children:e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(X,{margin:"normal",required:!0,fullWidth:!0,size:"small",label:"Nombre",autoFocus:!0,autoComplete:"name",error:!!((p=i.name)!=null&&p.message),helperText:!!((f=i.name)!=null&&f.message)&&String(i.name.message),...E("name")})})}),e.jsxs(Y,{sx:{m:1.5},variant:"standard",error:!!((h=i.permissions)!=null&&h.message),children:[e.jsx(Z,{children:"Permisos"}),e.jsx(U,{name:"permissions",render:()=>{var a;return(a=m==null?void 0:m.data)==null?void 0:a.map(r=>{var o;return e.jsx(J,{control:e.jsx($,{size:"small",color:"secondary",onChange:()=>R(r),defaultChecked:!!((o=s==null?void 0:s.permissions)!=null&&o.find(t=>t.action===r.action))}),label:r.action},r.id)})},control:S}),e.jsx(ee,{children:!!((x=i.permissions)!=null&&x.message)&&String(i.permissions.message)})]})]})})]})}export{ge as R};
