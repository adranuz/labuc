import{r as g,j as e,w as j,s as L,T as R,E as I,g as f,q,x as $}from"./index-32292c13.js";import{d as B,D as A,a as F,b as z,c as _}from"./Delete-298fa468.js";import{d as N}from"./Search-c858a086.js";import{T as O}from"./Toolbar-d70cb619.js";import{u as W}from"./common-f0c17bc9.js";import{A as U}from"./constants-a5768e35.js";import{D as J,a as H,b as M}from"./DialogActions-c49c2bf1.js";import{A as V}from"./Alert-c2f8e205.js";import{L as G}from"./LoadingButton-e0ccb8bc.js";import{u as v,P as K}from"./Paper-d19b285b.js";import{I as Q}from"./Select-1f7de27f.js";import{L as X}from"./LinearProgress-2186b45d.js";import{T as Y,a as Z,b as ee,c as E,d as c,e as ae}from"./TableRow-2aaefee4.js";import{S as y}from"./Stack-b443227d.js";import{C as re}from"./Chip-94effd15.js";import{T as te}from"./TablePagination-b1f8bda9.js";import{C as se}from"./Container-430f5354.js";import{P as ie}from"./Page-163afb69.js";import"./createSvgIcon-abbd2357.js";import"./ArrowBack-77e9619e.js";import"./Toolbar-c06937fa.js";import"./Backdrop-752351c6.js";import"./middleware-4d18dae0.js";import"./Menu-3217b6b0.js";import"./KeyboardArrowRight-8567b424.js";import"./MenuItem-416c8a5f.js";import"./dividerClasses-39a22909.js";function ne({id:t,name:d,onFinished:m}){var x;const[b,p]=g.useState(!1),[i,u]=g.useState(!1),o=W(n=>n.showSnackbar),h=()=>{p(!0)},l=()=>{p(!1)},P=()=>{C({id:t})},C=({id:n})=>{u(!0);const a=new URL(`${U}/users/${n}`);fetch(a,{method:"DELETE"}).then(async s=>await s.json()).then(s=>{o("El usuario se eliminó corretamente","success"),m()}).catch(s=>o("Error al intentar eliminar el usuario","error")).finally(()=>{p(!1),u(!1)})},S=()=>{const n=localStorage.getItem("token");if(n)return w(n)},w=n=>JSON.parse(decodeURIComponent(escape(atob(n.split(".")[1]))));return e.jsxs(e.Fragment,{children:[e.jsx(j,{size:"small",color:"error",startIcon:e.jsx(B,{}),onClick:h,disabled:t===((x=S())==null?void 0:x.id),children:"Eliminar"}),e.jsxs(J,{fullWidth:!0,maxWidth:"sm",open:b,onClose:l,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(A,{id:"alert-dialog-title",children:"Eliminar usuario"}),e.jsxs(H,{children:[e.jsxs(F,{id:"alert-dialog-description",children:[e.jsx(V,{severity:"error",children:"Depués de eliminar un usuario, este se borra de manera permanente. Esta acción no se puede deshacer."}),e.jsxs(L,{m:2,children:[e.jsx(R,{variant:"caption",children:"Nombre del usuario"}),e.jsx(R,{mt:1,color:"black",children:d})]})]}),e.jsxs(M,{children:[e.jsx(j,{size:"small",onClick:l,children:"Cancelar"}),e.jsx(G,{loading:i,variant:"contained",color:"error",size:"small",loadingPosition:"start",disableElevation:!0,autoFocus:!0,onClick:P,children:"Eliminar"})]})]})]})]})}const oe=I("div")(({theme:t})=>({position:"relative",borderRadius:t.shape.borderRadius,backgroundColor:v().palette.mode==="dark"?f(t.palette.common.white,.15):f(t.palette.common.black,.05),"&:hover":{backgroundColor:v().palette.mode==="dark"?f(t.palette.common.white,.25):f(t.palette.common.black,.15)},marginLeft:0,width:"100%",[t.breakpoints.up("sm")]:{marginLeft:t.spacing(1),width:"auto"}})),le=I("div")(({theme:t})=>({padding:t.spacing(0,2),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"})),ce=I(Q)(({theme:t})=>({color:"inherit","& .MuiInputBase-input":{padding:t.spacing(1,1,1,0),paddingLeft:`calc(1em + ${t.spacing(4)})`,transition:t.transitions.create("width"),width:"100%",[t.breakpoints.up("sm")]:{width:"12ch","&:focus":{width:"20ch"}}}}));function de(){var n;const t=q(),[d,m]=$(),[b,p]=g.useState(!1),[i,u]=g.useState({}),[o,h]=g.useState({perPage:parseInt(d.get("perPage")??"10"),page:parseInt(d.get("page")??"0"),q:d.get("q")??""});g.useEffect(()=>{l(o)},[]);const l=({perPage:a,page:s,q:r})=>{p(!0);const T=new URL(`${U}/users`),D={perPage:String(a),page:String(s),q:r};T.search=new URLSearchParams(D).toString(),fetch(T).then(async k=>await k.json()).then(k=>{u(k)}).finally(()=>p(!1))},P=(a,s)=>{const r={...o,page:s};h(r),l(r),m({perPage:String(r.perPage),page:String(r.page),q:r.q})},C=a=>{const s=parseInt(a.target.value),r={...o,perPage:s,page:0};h(r),l(r),m({perPage:String(r.perPage),page:String(r.page),q:r.q})},S=a=>{const s=a.target.value,r={...o,q:s,page:0};h(r),l(r),m({perPage:String(r.perPage),page:String(r.page),q:r.q})},w=a=>{t(`/admin/users/${a}/edit`)},x=()=>{t("/admin/users/create")};return e.jsx(L,{sx:{width:"100%",position:"relative"},children:e.jsxs(K,{variant:"outlined",sx:{width:"100%",mb:2},children:[e.jsxs(O,{title:"Clientes",children:[e.jsxs(oe,{children:[e.jsx(le,{children:e.jsx(N,{})}),e.jsx(ce,{placeholder:"Buscar…",type:"search",inputProps:{"aria-label":"search"},onChange:S,defaultValue:d.get("q")})]}),e.jsx(j,{size:"small",color:"primary",startIcon:e.jsx(z,{}),onClick:()=>x(),children:"Agregar"})]}),b&&e.jsx(X,{sx:{position:"absolute",top:"0",left:0,right:0,borderTopLeftRadius:4,borderTopRightRadius:4}}),e.jsx(Y,{children:e.jsxs(Z,{size:"small",children:[e.jsx(ee,{children:e.jsxs(E,{children:[e.jsx(c,{children:"Nombre"}),e.jsx(c,{children:"Correo electrónico"}),e.jsx(c,{children:"Roles"}),e.jsx(c,{align:"right",children:"Acciones"})]})}),e.jsx(ae,{children:(n=i==null?void 0:i.data)==null?void 0:n.map(a=>{var s;return e.jsxs(E,{children:[e.jsx(c,{children:a.name}),e.jsx(c,{children:a.email}),e.jsx(c,{children:e.jsx(y,{direction:"row",spacing:1,children:(s=a.roles)==null?void 0:s.map(r=>e.jsx(re,{label:r.name,variant:"outlined",size:"small",color:"primary",sx:{textTransform:"capitalize"}},r.name))})}),e.jsx(c,{children:e.jsxs(y,{direction:"row",spacing:1,justifyContent:"flex-end",children:[e.jsx(j,{size:"small",color:"info",startIcon:e.jsx(_,{}),onClick:()=>w(a.id),children:"Editar"}),e.jsx(ne,{id:a.id,name:a.name,onFinished:()=>l(o)})]})})]},a.id)})})]})}),e.jsx(te,{rowsPerPageOptions:[5,10,25,100],component:"div",count:(i==null?void 0:i.total)??0,rowsPerPage:o.perPage,page:(i==null?void 0:i.page)??0,onPageChange:P,onRowsPerPageChange:C,labelRowsPerPage:"Filas por página:",labelDisplayedRows:({from:a,to:s,count:r})=>`${a}-${s} de ${r}`,showFirstButton:!0,showLastButton:!0,getItemAriaLabel:a=>a==="first"?"Ir a la primera página":a==="last"?"Ir a la última página":a==="next"?"Ir a la página siguiente":"Regresar a la pagina anterior"})]})})}function pe(){return e.jsx(se,{sx:{mt:4,mb:4},children:e.jsx(de,{})})}function ze(){return e.jsx(ie,{title:"Usuarios",children:e.jsx(pe,{})})}export{ze as default};
