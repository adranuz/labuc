import{r as f,u as ae,a as re,_ as G,j as e,i as oe}from"./index-0c29d899.js";import{r as P,i as S}from"./createSvgIcon-3d5d7fc7.js";import{a as z}from"./api-ff746449.js";import{f as se,T as ne,a as ie,b as le,c as M,d as o,e as ce,L as de}from"./TableRow-fc5bf907.js";import{S as ue}from"./Stack-75599046.js";import{L as U,C as pe}from"./LoadingButton-047ce5b6.js";import{g as he,E as ve,c as fe,a as xe}from"./styled-1354fb8a.js";import{g as me,T as ge,P as je}from"./Typography-3ca4fb90.js";import{u as be}from"./common-3c77f740.js";import{C as _e}from"./Container-18546780.js";import{T as Re}from"./Toolbar-5d78288d.js";import{B as Q}from"./Box-c9cec713.js";import{T as ye,a as Te,b as k,c as I}from"./TabPanel-63ce7963.js";import{B as Ce}from"./Backdrop-956e9521.js";import{P as Pe}from"./Page-1a493442.js";import"./KeyboardArrowRight-b37c2a27.js";function Se(t){return he("MuiTableFooter",t)}me("MuiTableFooter",["root"]);const Le=["className","component"],$e=t=>{const{classes:l}=t;return xe({root:["root"]},Se,l)},De=ve("tfoot",{name:"MuiTableFooter",slot:"Root",overridesResolver:(t,l)=>l.root})({display:"table-footer-group"}),Ae={variant:"footer"},J="tfoot",Me=f.forwardRef(function(l,c){const r=ae({props:l,name:"MuiTableFooter"}),{className:h,component:i=J}=r,u=re(r,Le),g=G({},r,{component:i}),j=$e(g);return e.jsx(se.Provider,{value:Ae,children:e.jsx(De,G({as:i,className:fe(j.root,h),ref:c,role:i===J?null:"rowgroup",ownerState:g},u))})}),ke=Me;var w={},Ie=S;Object.defineProperty(w,"__esModule",{value:!0});var K=w.default=void 0,Oe=Ie(P()),ze=e,Be=(0,Oe.default)((0,ze.jsx)("path",{d:"m22.7 19-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"}),"Build");K=w.default=Be;var H={},Ue=S;Object.defineProperty(H,"__esModule",{value:!0});var W=H.default=void 0,we=Ue(P()),He=e,We=(0,we.default)((0,He.jsx)("path",{d:"M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"}),"Download");W=H.default=We;var F={},Fe=S;Object.defineProperty(F,"__esModule",{value:!0});var X=F.default=void 0,qe=Fe(P()),Ee=e,Ne=(0,qe.default)((0,Ee.jsx)("path",{d:"m17.6 9.48 1.84-3.18c.16-.31.04-.69-.26-.85-.29-.15-.65-.06-.83.22l-1.88 3.24c-2.86-1.21-6.08-1.21-8.94 0L5.65 5.67c-.19-.29-.58-.38-.87-.2-.28.18-.37.54-.22.83L6.4 9.48C3.3 11.25 1.28 14.44 1 18h22c-.28-3.56-2.3-6.75-5.4-8.52zM7 15.25c-.69 0-1.25-.56-1.25-1.25s.56-1.25 1.25-1.25 1.25.56 1.25 1.25-.56 1.25-1.25 1.25zm10 0c-.69 0-1.25-.56-1.25-1.25s.56-1.25 1.25-1.25 1.25.56 1.25 1.25-.56 1.25-1.25 1.25z"}),"Android");X=F.default=Ne;var q={},Ve=S;Object.defineProperty(q,"__esModule",{value:!0});var Y=q.default=void 0;Je(f);var Ge=Ve(P()),Qe=e;function Z(t){if(typeof WeakMap!="function")return null;var l=new WeakMap,c=new WeakMap;return(Z=function(r){return r?c:l})(t)}function Je(t,l){if(!l&&t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var c=Z(l);if(c&&c.has(t))return c.get(t);var r={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(i!=="default"&&Object.prototype.hasOwnProperty.call(t,i)){var u=h?Object.getOwnPropertyDescriptor(t,i):null;u&&(u.get||u.set)?Object.defineProperty(r,i,u):r[i]=t[i]}return r.default=t,c&&c.set(t,r),r}var Ke=(0,Ge.default)((0,Qe.jsx)("path",{d:"M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"}),"Apple");Y=q.default=Ke;var E={},Xe=S;Object.defineProperty(E,"__esModule",{value:!0});var ee=E.default=void 0,Ye=Xe(P()),Ze=e,et=(0,Ye.default)((0,Ze.jsx)("path",{d:"M20 18v-1c1.1 0 1.99-.9 1.99-2L22 5c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2v1H0v2h24v-2h-4zM4 5h16v10H4V5z"}),"LaptopWindows");ee=E.default=et;var N={},tt=S;Object.defineProperty(N,"__esModule",{value:!0});var te=N.default=void 0,at=tt(P()),rt=e,ot=(0,at.default)((0,rt.jsx)("path",{d:"M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"}),"Devices");te=N.default=ot;function O({data:t,deviceType:l,isLoading:c}){var g,j,s,L,p,$,D,R,A;const[r,h]=f.useState(null),i=(a,x,y)=>{h(y);const b=new URL(`${z}/blocking/report/customer/download`),_={deviceType:a,name:x};b.search=new URLSearchParams(_).toString();let m="";fetch(b).then(v=>{const n=v.headers.get("Content-Disposition");return n&&(m=n.split(";")[1].split("=")[1].replaceAll('"',"")),v.blob()}).then(v=>URL.createObjectURL(v)).then(v=>{Object.assign(document.createElement("a"),{href:v,download:m}).click()}).finally(()=>{h(null)})},u=(a,x)=>{i(l,a,x)};return e.jsx(ne,{sx:{maxHeight:551},children:e.jsxs(ie,{stickyHeader:!0,size:"small",children:[e.jsx(le,{children:e.jsxs(M,{children:[e.jsx(o,{children:"Cliente"}),e.jsx(o,{align:"right",children:"Facturables"}),e.jsx(o,{align:"right",children:"No Facturables"}),e.jsx(o,{align:"right",children:"APS"}),e.jsx(o,{align:"right",children:"APQ"}),e.jsx(o,{align:"right",children:"Acciones"})]})}),e.jsx(ce,{children:(g=t==null?void 0:t.activationReport)==null?void 0:g.map((a,x)=>{var y,b,_,m;return e.jsxs(M,{children:[e.jsx(o,{component:"th",scope:"row",children:a==null?void 0:a.customerName}),e.jsx(o,{align:"right",children:(y=a==null?void 0:a._sum)==null?void 0:y.billable}),e.jsx(o,{align:"right",children:(b=a==null?void 0:a._sum)==null?void 0:b.nonBillable}),e.jsx(o,{align:"right",children:(_=a==null?void 0:a._sum)==null?void 0:_.billableWeekly}),e.jsx(o,{align:"right",children:(m=a==null?void 0:a._sum)==null?void 0:m.billableBiweekly}),e.jsx(o,{children:e.jsx(ue,{direction:"row",spacing:1,justifyContent:"flex-end",children:e.jsx(U,{size:"small",color:"primary",loadingPosition:"start",startIcon:e.jsx(W,{}),onClick:()=>u(a==null?void 0:a.customerName,x),disabled:r!==null||c,loading:r===x,children:"Exportar (.csv)"})})})]},a==null?void 0:a.customerName)})}),e.jsxs(ke,{sx:{left:0,bottom:0,zIndex:2,position:"sticky"},children:[e.jsx(M,{children:e.jsx(o,{colSpan:6,sx:{padding:0}})}),e.jsxs(M,{children:[e.jsx(o,{variant:"head",children:"Totales"}),e.jsx(o,{align:"right",variant:"head",children:(s=(j=t==null?void 0:t.activationReportTotals)==null?void 0:j._sum)==null?void 0:s.billable}),e.jsx(o,{align:"right",variant:"head",children:(p=(L=t==null?void 0:t.activationReportTotals)==null?void 0:L._sum)==null?void 0:p.nonBillable}),e.jsx(o,{align:"right",variant:"head",children:(D=($=t==null?void 0:t.activationReportTotals)==null?void 0:$._sum)==null?void 0:D.billableWeekly}),e.jsx(o,{align:"right",variant:"head",children:(A=(R=t==null?void 0:t.activationReportTotals)==null?void 0:R._sum)==null?void 0:A.billableBiweekly}),e.jsx(o,{align:"right",variant:"head"})]})]})]})})}function st(){var _,m,v;const t=be(n=>n.showSnackbar),[l,c]=oe(),[r,h]=f.useState(!1),[i,u]=f.useState(!1),[g,j]=f.useState(!1),[s,L]=f.useState({}),[p,$]=f.useState(l.get("tab")||"all"),D=(n,d)=>{$(d),c({tab:d}),R(d)};f.useEffect(()=>{R(p)},[]);const R=n=>{h(!0);const d=new URL(`${z}/blocking/report/activation`),B={deviceType:n};d.search=new URLSearchParams(B).toString(),fetch(d).then(T=>T.json()).then(T=>{L(T)}).finally(()=>h(!1))},A=()=>{u(!0);const n=new URL(`${z}/blocking/report/activation`);fetch(n,{method:"POST"}).then(d=>d.json()).then(()=>{R(p),t("El consolidado se generÃ³ correctamente","success")}).finally(()=>u(!1))},a=n=>{j(!0);const d=new URL(`${z}/blocking/report/activation/download`),B={deviceType:n};d.search=new URLSearchParams(B).toString();let T="";fetch(d).then(C=>{const V=C.headers.get("Content-Disposition");return V&&(T=V.split(";")[1].split("=")[1].replaceAll('"',"")),C.blob()}).then(C=>URL.createObjectURL(C)).then(C=>{Object.assign(document.createElement("a"),{href:C,download:T}).click()}).finally(()=>{j(!1)})},x=()=>{A()},y=()=>{a(p)},b=n=>{if(n)return new Date(n).toLocaleString("es",{dateStyle:"medium",timeStyle:"short",hour12:!0})};return e.jsxs(_e,{sx:{mt:4,mb:4},children:[e.jsxs(Re,{disableGutters:!0,children:[e.jsxs(ge,{component:"h2",variant:"h5",noWrap:!0,sx:{flexGrow:1},children:["Consolidado ",b((_=s==null?void 0:s.lastBlockingDeviceImport)==null?void 0:_.createdAt)]}),e.jsxs(Q,{sx:{display:"flex",gap:2},children:[e.jsx(U,{size:"small",color:"primary",loadingPosition:"start",startIcon:e.jsx(K,{}),onClick:()=>x(),disabled:((m=s==null?void 0:s.activationReport)==null?void 0:m.length)!==0,loading:i,children:"Generar"}),e.jsx(U,{size:"small",color:"primary",loadingPosition:"start",startIcon:e.jsx(W,{}),onClick:()=>y(),disabled:r||((v=s==null?void 0:s.activationReport)==null?void 0:v.length)===0,loading:g,children:"Descargar reporte (.xlsx)"})]})]}),e.jsx(je,{variant:"outlined",sx:{position:"relative"},children:e.jsxs(ye,{value:p,children:[e.jsx(Q,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Te,{onChange:D,indicatorColor:"secondary",children:[e.jsx(k,{icon:e.jsx(te,{}),iconPosition:"start",label:"Todos",value:"all"}),e.jsx(k,{icon:e.jsx(X,{}),iconPosition:"start",label:"Android",value:"android"}),e.jsx(k,{icon:e.jsx(Y,{}),iconPosition:"start",label:"iOS",value:"ios"}),e.jsx(k,{icon:e.jsx(ee,{}),iconPosition:"start",label:"Windows",value:"windows"})]})}),r&&e.jsx(de,{sx:{position:"absolute",top:"0",left:0,right:0,borderRadius:4,zIndex:3}}),e.jsx(I,{value:"all",sx:{padding:0},children:e.jsx(O,{data:s,deviceType:p,isLoading:r})}),e.jsx(I,{value:"android",sx:{padding:0},children:e.jsx(O,{data:s,deviceType:p,isLoading:r})}),e.jsx(I,{value:"ios",sx:{padding:0},children:e.jsx(O,{data:s,deviceType:p,isLoading:r})}),e.jsx(I,{value:"windows",sx:{padding:0},children:e.jsx(O,{data:s,deviceType:p,isLoading:r})})]})}),e.jsx(Ce,{sx:{color:"#fff",zIndex:n=>n.zIndex.drawer+1},open:i,children:e.jsx(pe,{color:"inherit"})})]})}function yt(){return e.jsx(Pe,{title:"Consolidado",children:e.jsx(st,{})})}export{yt as default};
