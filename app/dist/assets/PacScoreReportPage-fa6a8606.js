import{x as k,j as e,r as Y,A as B}from"./index-d910b063.js";import{T as W}from"./Toolbar-79d34470.js";import{d as q}from"./Download-baee0318.js";import{l as N}from"./utils-ae6c9da2.js";import{u as O}from"./pac-02dfde38.js";import{B as _}from"./BooleanIndicator-631b5013.js";import{T as H,a as V,b as G,c as E,d as l,e as J}from"./TableRow-64f07200.js";import{C as K}from"./Chip-0e9552d9.js";import{T as Q}from"./TablePagination-9e47dea6.js";import{A as X}from"./constants-53c7a41b.js";import{C as Z}from"./Container-07cda008.js";import{P as ee}from"./Paper-37965af9.js";import{F as te,I as ae}from"./FormControl-070dad34.js";import{S as re}from"./Select-4dcb9f12.js";import{M as A}from"./MenuItem-3d2809ad.js";import{L as oe}from"./LoadingButton-54b2c4a2.js";import{L as se}from"./LinearProgress-f1b553ec.js";import{D as z}from"./DatePicker-6292aa46.js";import{P as ne}from"./Page-3b479898.js";import"./ArrowBack-1462d81c.js";import"./createSvgIcon-08e146b5.js";import"./Toolbar-bb7e79c6.js";import"./Backdrop-6925e10d.js";import"./middleware-514cbe06.js";import"./Close-6831e9e7.js";import"./Tooltip-511de29e.js";import"./Popper-3e4155a9.js";import"./KeyboardArrowRight-03ef775b.js";import"./Menu-f153eb6a.js";import"./dividerClasses-c9f1e17e.js";import"./Grid-1fa796df.js";import"./TextField-47f91fce.js";import"./InputAdornment-3c5fa331.js";import"./DialogActions-16821337.js";import"./listItemButtonClasses-83f7acd4.js";function ie({customerId:a,status:u,startDate:o,endDate:b}){var R;const[r,S]=k(),[j,P,D,d]=O(s=>[s.getScoreReportListFilters,s.setScoreReportListFilters,s.getScoreReportList,s.scoreReportList]),n=(s,c)=>{if(a===void 0)return;const p={...j,page:c};P(p),D(a,u,o,b),r.set("page",String(c)),S(r)},m=s=>{if(a===void 0)return;const c=parseInt(s.target.value),p={...j,perPage:c,page:0};P(p),D(a,u,o,b),r.set("perPage",String(c)),S(r)};return e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsxs(V,{size:"small",children:[e.jsx(G,{children:e.jsxs(E,{children:[e.jsx(l,{children:"No. de crédito"}),e.jsx(l,{children:"Referencia"}),e.jsx(l,{children:"No. Solicitud"}),e.jsx(l,{children:"Fecha"}),e.jsx(l,{children:"Estado"}),e.jsx(l,{align:"center",children:"Score"}),e.jsx(l,{align:"center",children:"Dispositivo validado previamente"}),e.jsx(l,{children:"ID de dispositivo"})]})}),e.jsx(J,{children:(R=d==null?void 0:d.data)==null?void 0:R.map(({status:s,creditId:c,previouslyValidatedDevice:p,reference:g,requestDate:h,requestId:M,score:w,deviceId:F})=>e.jsxs(E,{hover:!0,children:[e.jsx(l,{children:c}),e.jsx(l,{children:g}),e.jsx(l,{children:M}),e.jsx(l,{children:!!h&&N({date:h})}),e.jsx(l,{children:e.jsx(K,{label:s,variant:"outlined",size:"small",color:s==="Aceptado"?"success":"warning"})}),e.jsx(l,{align:"center",children:w}),e.jsx(l,{align:"center",children:e.jsx(_,{value:p==="Si"})}),e.jsx(l,{children:F})]},c))})]})}),e.jsx(Q,{rowsPerPageOptions:[5,10,25,100],component:"div",count:(d==null?void 0:d.total)??0,rowsPerPage:j.perPage,page:(d==null?void 0:d.page)??0,onPageChange:n,onRowsPerPageChange:m,labelRowsPerPage:"Filas por página:",labelDisplayedRows:({from:s,to:c,count:p})=>`${s}-${c} de ${p}`,showFirstButton:!0,showLastButton:!0,getItemAriaLabel:s=>s==="first"?"Ir a la primera página":s==="last"?"Ir a la última página":s==="next"?"Ir a la página siguiente":"Regresar a la pagina anterior"})]})}function le(){const[a,u]=k(),[o,b]=Y.useState(a.get("startDate")?B(a.get("startDate")):null),[r,S]=Y.useState(a.get("endDate")?B(a.get("endDate")):null),[j,P]=Y.useState(!1),[D,d]=Y.useState(!1),n=a.get("customerId")??void 0,[m,R]=Y.useState(a.get("status")??void 0),s=[{id:"accepted",name:"Aceptado"},{id:"notAccepted",name:"No aceptado"}],[c,p,g,h]=O(t=>[t.getScoreReportListFilters,t.setScoreReportListFilters,t.getScoreReportList,t.getScoreReportListLoading]),M=t=>{b(t),t!==null?a.set("startDate",t.format("YYYY-MM-DD")):a.delete("startDate"),a.set("page","0"),u(a);const i={...c,page:0};p(i),t&&r&&n&&g(n,m,t.format("YYYY-MM-DD"),r.format("YYYY-MM-DD")),t===null&&r==null&&n&&g(n,m)},w=t=>{S(t),t!==null?a.set("endDate",t.format("YYYY-MM-DD")):a.delete("endDate"),a.set("page","0"),u(a);const i={...c,page:0};p(i),o&&t&&n&&g(n,m,o.format("YYYY-MM-DD"),t.format("YYYY-MM-DD")),o===null&&t==null&&n&&g(n,m)},F=t=>{const i=t.target.value;R(i),console.log(i),a.set("status",i),a.set("page","0"),u(a);const f={...c,page:0};p(f),n&&g(n,i,o==null?void 0:o.format("YYYY-MM-DD"),r==null?void 0:r.format("YYYY-MM-DD"))},$=()=>{U(n,m,o==null?void 0:o.format("YYYY-MM-DD"),r==null?void 0:r.format("YYYY-MM-DD"))},U=(t,i,f,C)=>{d(!0);const L=new URL(`${X}/pac/customers/${t}/score/report/download`),T={};Object.assign(T,i&&{status:i},f&&C&&{startDate:f,endDate:C}),L.search=new URLSearchParams(T).toString();let v="";fetch(L).then(async x=>{const I=x.headers.get("Content-Disposition");return I&&(v=I.split(";")[1].split("=")[1].replaceAll('"',"")),await x.blob()}).then(x=>URL.createObjectURL(x)).then(x=>{Object.assign(document.createElement("a"),{href:x,download:v}).click()}).finally(()=>{d(!1)})},y=t=>t.isBefore(o);return Y.useEffect(()=>{if(n===void 0)return;const t=a.get("perPage"),i=a.get("page"),f=a.get("q");p({perPage:t!==null?parseInt(t):10,page:i!==null?parseInt(i):0,q:f?c.q:""}),console.log("setSearchParams"),console.log(a.values()),g(n,m,o==null?void 0:o.format("YYYY-MM-DD"),r==null?void 0:r.format("YYYY-MM-DD"))},[]),e.jsx(Z,{sx:{mt:4,mb:4},maxWidth:"xl",children:e.jsxs(ee,{variant:"outlined",sx:{width:"100%",mb:2,pt:1,position:"relative"},children:[e.jsxs(W,{title:"Reporte de score PAC",pathRouteForBackButton:`/tool/pac/score?customerId=${n}`,children:[e.jsx(z,{value:o,onChange:M,label:"Fecha de inicio",slotProps:{actionBar:{actions:["clear"]},textField:o===null&&r!==null?{size:"small",error:!0}:{size:"small"}},disableFuture:!0,sx:{maxWidth:180},disabled:h}),e.jsx(z,{value:r,open:j,onChange:w,onClose:()=>{P(!1)},onOpen:()=>{P(!0)},label:"Fecha de fin",slotProps:{actionBar:{actions:["clear"]},textField:o!==null&&r===null?{size:"small",error:!0}:{size:"small"}},disableFuture:!0,shouldDisableDate:y,sx:{maxWidth:180},disabled:h}),e.jsxs(te,{margin:"none",size:"small",sx:{minWidth:135},disabled:h,children:[e.jsx(ae,{children:"Estado"}),e.jsxs(re,{label:"Estado",onChange:F,defaultValue:m,children:[e.jsx(A,{value:"",children:e.jsx("em",{children:"Todos"})}),s==null?void 0:s.map(({id:t,name:i})=>e.jsx(A,{value:t,children:i},t))]})]}),e.jsx(oe,{size:"small",color:"primary",loadingPosition:"start",startIcon:e.jsx(q,{}),onClick:()=>$(),disabled:h||D,loading:D,children:"Descargar (.csv)"})]}),h&&e.jsx(se,{sx:{position:"absolute",top:"0",left:0,right:0,borderTopLeftRadius:4,borderTopRightRadius:4}}),e.jsx(ie,{customerId:n,status:m,startDate:o==null?void 0:o.format("YYYY-MM-DD"),endDate:r==null?void 0:r.format("YYYY-MM-DD")})]})})}function _e(){return e.jsx(ne,{title:"Reporte de score de crédito PAC",children:e.jsx(le,{})})}export{_e as default};
