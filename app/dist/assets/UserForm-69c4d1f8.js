import{f as W,r as $,j as e}from"./index-e06af375.js";import{o as u,s as i,a as z,u as O,t as P,C as R}from"./zod-c70e1e28.js";import{d as J,C as H}from"./SaveAlt-917863ad.js";import{d as A,F as D}from"./ArrowBack-5b5e2c49.js";import{u as K}from"./common-5771c6fd.js";import{a as w}from"./api-ff746449.js";import{B as U}from"./Box-88fb8089.js";import{T as M}from"./Toolbar-7d3cc063.js";import{I as Q}from"./Menu-e27c80cb.js";import{T as X}from"./Typography-c441fe83.js";import{B as Y}from"./Page-a29a2f01.js";import{L as Z}from"./LoadingButton-3a7488f1.js";import{C as ee,a as re}from"./CardContent-9509f165.js";import{G as m}from"./Grid-d5f187a5.js";import{T as x,F as ae,a as oe,b as se}from"./TextField-d9fc59e3.js";const ne=u({name:i({required_error:"Se requiere el nombre"}).nonempty({message:"Se requiere el nombre"}),email:i({required_error:"Se requiere la dirección de correo electrónico"}).nonempty({message:"Se requiere la dirección de correo electrónico"}).email("La dirección de correo electrónico es inválida"),roles:z(u({name:i({required_error:"Se requiere el nombre del rol"})})).nonempty({message:"Se requiere al menos un rol"})}),te=u({name:i({required_error:"Se requiere el nombre"}).min(1,{message:"Se requiere el nombre"}),email:i({required_error:"Se requiere la dirección de correo electrónico"}).min(1,{message:"Se requiere la dirección de correo electrónico"}).email("La dirección de correo electrónico es inválida"),roles:z(u({name:i({required_error:"Se requiere el nombre del rol"})})).nonempty({message:"Se requiere al menos un rol"}),password:i({required_error:"Se requiere la contraseña"}).nonempty({message:"Se requiere la contraseña"}).min(8,"La contraseña debe tener más de 8 caracteres")});function qe({user:r,roles:p}){var g,b,S,j,C,q,y,T;const L=W(),[f,c]=$.useState(!1),l=K(o=>o.showSnackbar),{control:_,formState:{errors:s},getValues:k,handleSubmit:v,register:h,setValue:E}=O({defaultValues:{name:r==null?void 0:r.name,email:r==null?void 0:r.email,roles:(r==null?void 0:r.roles)||[]},resolver:P(r?ne:te)}),F=o=>{const{roles:a}=k(),n=a!=null&&a.find(t=>t.name===o.name)?a==null?void 0:a.filter(t=>t.name!==o.name):[...a??[],{name:o.name}];E("roles",n)},B=o=>{r?G(r.id,o):I(o)},G=(o,a)=>{c(!0);const n=new URL(`${w}/users/${o}`);fetch(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(t=>{if(!t.ok){l("Error al intentar acualizar el usuario","error");return}d(),l("El usuario se actualizó correctamente","success")}).catch(t=>l("Error al intentar acualizar el usuario","error")).finally(()=>c(!1))},I=o=>{c(!0);const a=new URL(`${w}/users`);fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(n=>{if(!n.ok){l("Error al intentar crear el usuario","error");return}d(),l("El usuario se creó correctamente","success")}).catch(n=>l("Error al intentar crear el usuario","error")).finally(()=>c(!1))},N=()=>{d()},V=()=>{d()},d=()=>{L("/admin/users")};return e.jsxs(U,{component:"form",onSubmit:v(B),noValidate:!0,children:[e.jsxs(M,{disableGutters:!0,children:[e.jsx(Q,{size:"large",color:"inherit",sx:{mr:2},onClick:N,children:e.jsx(A,{})}),e.jsx(X,{component:"h2",variant:"h5",noWrap:!0,sx:{flexGrow:1},children:"Usuario"}),e.jsxs(U,{sx:{display:"flex",gap:2},children:[e.jsx(Y,{size:"small",onClick:V,disabled:f,children:"Cancelar"}),e.jsx(Z,{variant:"contained",size:"small",loadingPosition:"start",disableElevation:!0,startIcon:e.jsx(J,{}),type:"submit",disabled:f,children:"Guardar"})]})]}),e.jsx(ee,{variant:"outlined",children:e.jsxs(re,{children:[e.jsxs(m,{container:!0,spacing:3,children:[e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(x,{margin:"normal",required:!0,fullWidth:!0,size:"small",label:"Nombre",autoFocus:!0,autoComplete:"name",error:!!((g=s.name)!=null&&g.message),helperText:!!((b=s.name)!=null&&b.message)&&String(s.name.message),...h("name")})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(x,{margin:"normal",required:!0,fullWidth:!0,size:"small",label:"Correo electrónico",autoComplete:"email",error:!!((S=s.email)!=null&&S.message),helperText:!!((j=s.email)!=null&&j.message)&&String(s.email.message),...h("email"),disabled:!!r})})]}),!r&&e.jsx(m,{container:!0,spacing:3,children:e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(x,{margin:"normal",required:!0,fullWidth:!0,size:"small",label:"Contraseña",type:"password",error:!!((C=s.password)!=null&&C.message),helperText:!!((q=s.password)!=null&&q.message)&&String(s.password.message),...h("password")})})}),e.jsxs(ae,{sx:{m:1.5},variant:"standard",error:!!((y=s.roles)!=null&&y.message),children:[e.jsx(oe,{children:"Roles"}),e.jsx(R,{name:"roles",render:()=>{var o;return(o=p==null?void 0:p.data)==null?void 0:o.map(a=>{var n;return e.jsx(D,{sx:{textTransform:"capitalize"},control:e.jsx(H,{size:"small",color:"secondary",onChange:()=>F(a),defaultChecked:!!((n=r==null?void 0:r.roles)!=null&&n.find(t=>t.name===a.name))}),label:a.name},a.id)})},control:_}),e.jsx(se,{children:!!((T=s.roles)!=null&&T.message)&&String(s.roles.message)})]})]})})]})}export{qe as U};
